<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ahmed | WPICTF 2020</title>
  <meta name="description" content="This is some of my writeups for WPICTF 2020.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="WPICTF 2020">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://y4mm1.github.io/posts/wpictf-2020">
  <meta property="og:description" content="This is some of my writeups for WPICTF 2020.">
  <meta property="og:site_name" content="Ahmed">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://y4mm1.github.io/posts/wpictf-2020">
  <meta name="twitter:title" content="WPICTF 2020">
  <meta name="twitter:description" content="This is some of my writeups for WPICTF 2020.">

  
    
      <meta property="og:image" content="https://y4mm1.github.io/assets/documentation/WPICTF/logo-bf66be92ddbda877b0df1e5a4e4467637e49249c65d2142e94ec1b10c01cb646.png">
      <meta name="twitter:image" content="https://y4mm1.github.io/assets/documentation/WPICTF/logo-bf66be92ddbda877b0df1e5a4e4467637e49249c65d2142e94ec1b10c01cb646.png">
    
  

  <link href="https://y4mm1.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="Ahmed Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-color-0e896bd8673d9f83cea8d7b0a12fcc894681d58fc475ad499adfed94067b1e1f.png">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-87d1f2a3a19b1500e5c1626a0492025ca5f7f97d24540dc5900288e92112925a.png">
      <link rel="stylesheet" type="text/css" href="/assets/light-d09aacb6545f381fc97f304886774210c2a8683515671143f960bc0912af94fe.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Ahmed">Ahmed</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about" xlink:href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a href="https://www.facebook.com/manneredperson" rel="noreferrer noopener" target="_blank" title="Facebook">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-facebook">
  <use href="/assets/facebook-5a38f0a900ec68e86eaccd4683fcad4e4de77281f876d9476a560a0a69cac8bf.svg#icon-facebook" xlink:href="/assets/facebook-5a38f0a900ec68e86eaccd4683fcad4e4de77281f876d9476a560a0a69cac8bf.svg#icon-facebook"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/y4mm1" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github" xlink:href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/sayeddd" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-3bd8eb5ea036958dc7b3ee3de6612dbfa9e0744f369f20f7895d6a2782bbaf43.svg#icon-linkedin" xlink:href="/assets/linkedin-3bd8eb5ea036958dc7b3ee3de6612dbfa9e0744f369f20f7895d6a2782bbaf43.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:ahmedsayedgfx@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-30a104adb1e2728097a984fbea2995978b6fff6c12906a734044ebd388848b70.svg#icon-email" xlink:href="/assets/email-30a104adb1e2728097a984fbea2995978b6fff6c12906a734044ebd388848b70.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-cdc7a721b47671668abb0ba57f9f8db8022096e0051ff51b9e08e6cc049453a4.svg#icon-rss" xlink:href="/assets/rss-cdc7a721b47671668abb0ba57f9f8db8022096e0051ff51b9e08e6cc049453a4.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
  </ul>
</nav>


  <ul class="header-tags scrollappear">
    
    
      
        <li><a href="/tag/AUCTF">Auctf</a></li>
    
      
        <li><a href="/tag/CTF">Ctf</a></li>
    
      
        <li><a href="/tag/WPICTF">Wpictf</a></li>
    
      
        <li><a href="/tag/algorithms">Algorithms</a></li>
    
      
        <li><a href="/tag/analysis">Analysis</a></li>
    
      
        <li><a href="/tag/angstromCTF">Angstromctf</a></li>
    
      
        <li><a href="/tag/c">C</a></li>
    
      
        <li><a href="/tag/cracking">Cracking</a></li>
    
      
        <li><a href="/tag/crypto">Crypto</a></li>
    
      
        <li><a href="/tag/cryptography">Cryptography</a></li>
    
      
        <li>...</li>
        <li><a href="/tags">Show all</a></li>
        
  </ul>


        <article class="article scrollappear">
          <header class="article-header">
            <h1>WPICTF 2020</h1>
            <p>This is some of my writeups for WPICTF 2020.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    April 20, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      8 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/security" title="See all posts with tag 'Security'">Security</a>
    
      
      <a href="/tag/WPICTF" title="See all posts with tag ''"></a>
    
      
      <a href="/tag/CTF" title="See all posts with tag 'CTF'">CTF</a>
    
      
      <a href="/tag/infosec" title="See all posts with tag 'Infosec'">Infosec</a>
    
      
      <a href="/tag/linux" title="See all posts with tag 'Linux'">Linux</a>
    
      
      <a href="/tag/python" title="See all posts with tag 'Python'">Python</a>
    
      
      <a href="/tag/shell" title="See all posts with tag 'Shell'">Shell</a>
    
      
      <a href="/tag/hacking" title="See all posts with tag 'Hacking'">Hacking</a>
    
      
      <a href="/tag/c" title="See all posts with tag 'C'">C</a>
    
      
      <a href="/tag/rsa" title="See all posts with tag 'Rsa'">Rsa</a>
    
      
      <a href="/tag/reverse" title="See all posts with tag 'Reverse'">Reverse</a>
    
      
      <a href="/tag/ida" title="See all posts with tag 'IDA'">IDA</a>
    
      
      <a href="/tag/steganography" title="See all posts with tag 'Steganography'">Steganography</a>
    
      
      <a href="/tag/crypto" title="See all posts with tag ''"></a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p><a href="/assets/documentation/WPICTF/logo-bf66be92ddbda877b0df1e5a4e4467637e49249c65d2142e94ec1b10c01cb646.png">
  <img src="/assets/documentation/WPICTF/logo-bf66be92ddbda877b0df1e5a4e4467637e49249c65d2142e94ec1b10c01cb646.png" alt="WPICTF" class="zooming" data-rjs="/assets/documentation/WPICTF/logo-bf66be92ddbda877b0df1e5a4e4467637e49249c65d2142e94ec1b10c01cb646.png" data-zooming-width="506" data-zooming-height="583" />
</a></p>

<p>I participated in WPI 2020 with my team <a href="https://ctftime.org/team/113157">P1rates</a> and I was able to solve some cool challenges with them. This is my writeup about some of them that I managed to solve during the competition.</p>

<h2 id="stego">Stego</h2>
<hr />

<h3 id="1-luna">1. Luna</h3>
<blockquote>
  <p>They say the full moon makes people go crazy… hopefully this stego won’t have the same effect on you!</p>
</blockquote>

<p>This challenge was the most interesting one I solved during the competition.
It gives us an archive <a href="https://gofile.io/?c=nsXYhZ"><code class="highlighter-rouge">Luna.tar.xz</code></a> and it contains a <code class="highlighter-rouge">1.png</code> image and another password protected archive <code class="highlighter-rouge">so you take the moon.zip</code>.</p>

<p>I tried to extract the password hash to crack it with <code class="highlighter-rouge">john</code> but it seems it was uncrackable password, so let’s look at the image.</p>

<p><a href="/assets/documentation/WPICTF/1-399743d67c4bf96130cc168755c7588a1d1bf8738a408a7c0ba439000bf9a58f.png">
  <img src="/assets/documentation/WPICTF/1-399743d67c4bf96130cc168755c7588a1d1bf8738a408a7c0ba439000bf9a58f.png" alt="flag" class="zooming" data-rjs="/assets/documentation/WPICTF/1-399743d67c4bf96130cc168755c7588a1d1bf8738a408a7c0ba439000bf9a58f.png" data-zooming-width="300" data-zooming-height="300" />
</a></p>

<p>It’s just an empty white image nothing usefull in it, so let’s try to run <code class="highlighter-rouge">exiftool</code> to see any hidden text.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>exiftool 1.png 
<span class="go">ExifTool Version Number         : 11.93
File Name                       : 1.png
Directory                       : .
File Size                       : 7.4 kB
File Modification Date/Time     : 2020:03:21 01:56:12+02:00
File Access Date/Time           : 2020:04:20 04:24:50+02:00
File Inode Change Date/Time     : 2020:04:20 04:24:50+02:00
File Permissions                : rw-rw-r--
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 300
Image Height                    : 300
Bit Depth                       : 8
Color Type                      : RGB
Compression                     : Deflate/Inflate
</span><span class="c">...
</span><span class="go">Thumbnail Offset                : 414
Thumbnail Length                : 1651
Time Created                    : 19:56:12-19:56
XMP Toolkit                     : XMP Core 4.4.0-Exiv2
Digital Source Type             : http://cv.iptc.org/newscodes/digitalsourcetype/softwareImage
Document ID                     : gimp:docid:gimp:456e1492-77c3-4f45-92c3-edd0541a4413
Instance ID                     : xmp.iid:3e22a217-d4a0-422b-9bc6-58f60eddf54d
Original Document ID            : xmp.did:cc8dad5e-07b5-4920-9533-fc26a32b80f0
Model Release Status            : None
Study Physician                 : awcIsALegendAndIHopeThisIsAStrongPasswordJackTheRipperBegone
Api                             : 2.0
Platform                        : Linux
Time Stamp                      : 1584748572978367
Version                         : 2.10.18
Format                          : image/png
Caption Writer                  : j00t
Date Created                    : 2020:03:20
Creator Tool                    : GIMP 2.10
Rating                          : 5
Person In Image                 : type="Bag" jutin
History Action                  : saved, saved, saved, saved, saved
History Changed                 : /metadata, /, /metadata, /metadata, /
History Instance ID             : xmp.iid:967142e5-a3e0-4326-8335-bbe854fe7477, xmp.iid:8b519cd0-a1e9-41f7-ae1b-5b66b66b699e, xmp.iid:b7345da5-469a-491b-86b2-ad14b96f1132, xmp.iid:69b7dcf5-be9f-446d-8614-9ddda3bded58, xmp.iid:f39a3ecb-64e6-4b8b-98f1-fcb5eb4e1539
History Software Agent          : Gimp 2.10 (Linux), Gimp 2.10 (Linux), Gimp 2.10 (Linux), Gimp 2.10 (Linux), Gimp 2.10 (Linux)
History When                    : -04:00, -04:00, -04:00, -04:00, -04:00
</span><span class="c">...</span></code></pre></figure>

<p>The image contains some useful info but there is one thing that made me pay attention<code class="highlighter-rouge">Study Physician: awcIsALegendAndIHopeThisIsAStrongPasswordJackTheRipperBegone</code>. So when I tried to unzip the archive with that password it worked and gave me 2 another files <code class="highlighter-rouge">Just In Case.png</code> and <code class="highlighter-rouge">jut</code>.</p>

<p>The image wasn’t useful for me maybe there is another solution i don’t know, but the other file seems interesting. The <code class="highlighter-rouge">file</code> command didn’t recognize it so let see the magic bytes.</p>

<p><code class="highlighter-rouge">00000000  42 50 53 31  54 42 8F 37   15 90 80 08  80 21 23 80      BPS1TB.7.....!#.</code></p>

<p>First I assumed that maybe a Photoshop <code class="highlighter-rouge">PSD</code> file since the magic bytes look similar. However I’ve tried to add the missing bytes and open it with Photoshop, but the file looks corrupted. I struggled at this point for some time, so let’s run <code class="highlighter-rouge">binwalk</code> to see any hidden files.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>binwalk jut
<span class="go">DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
45            0x2D            Zlib compressed data, best compression</span></code></pre></figure>

<p>There is a <code class="highlighter-rouge">zlib</code> file at position <code class="highlighter-rouge">0x2d</code> let’s extract it.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span><span class="nb">dd </span><span class="k">if</span><span class="o">=</span>jut <span class="nv">bs</span><span class="o">=</span>1 <span class="nv">skip</span><span class="o">=</span>45 <span class="nv">of</span><span class="o">=</span>file.zlib
<span class="go">17893+0 records in
17893+0 records out
17893 bytes (18 kB, 17 KiB) copied, 0.0917604 s, 195 kB/s</span></code></pre></figure>

<p>Now, we have <code class="highlighter-rouge">zlib</code> compressed file the goal is to extract and see if it contains any data. I wrote a <code class="highlighter-rouge">bash</code> line code to take the file and extract the data using <code class="highlighter-rouge">zlib</code> library in python.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/usr/bin/bash</span>
<span class="nb">cat</span> <span class="nv">$1</span> | python <span class="nt">-c</span> <span class="s2">"import zlib,sys;sys.stdout.write(zlib.decompress(sys.stdin.read()))"</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>./extract.sh file.zlib 
<span class="go">exif
    5364
45786966000049492a00080000000a0000010400010000002c0100000101040001000000
2c0100000201030003000000860000001a010500010000008c0000001b01050001000000
94000000280103000100000003000000310102000d0000009c0000003201020014000000
aa0000006987040001000000be0000002588040001000000d00000003201000008000800
0800fc2900005b000000fc2900005b00000047494d5020322e31302e3138000032303230
3a30333a32302031393a30343a313700010001a003000100000001000000000000000300
0200050003000000fa00000004000500030000001201000006000500010000002a010000
000000000000000001000000000000000100000000000000010000000000000001000000
00000000010000000000000001000000000000000a000000080000010400010000000001
000001010400010000000001000002010300030000009801000003010300010000000600
000006010300010000000600000015010300010000000300000001020400010000009e01
000002020400010000005013000000000000080008000800ffd8ffe000104a4649460001
</span><span class="c">....
</span><span class="go">a0028a28a0028a28a0028a28a0028a28a0028a28a0028a28a0028a28a0028a28a0028a28
a0028a28a0028a28a0028a28a0028a28a0028a28a0028a28a0028a28a0028a28a00fffd9</span></code></pre></figure>

<p>It looks interesting some hex bytes and I noticed that the last 2 bytes <code class="highlighter-rouge">ff d9</code>, so I assumed it’s a <code class="highlighter-rouge">jpg</code> image I searched for the first magic bytes <code class="highlighter-rouge">ff d8 ff</code> I found it at line <code class="highlighter-rouge">12</code> so let’s put those values into a new hex editor and save it as <code class="highlighter-rouge">flag.jpg</code>.</p>

<p><a href="/assets/documentation/WPICTF/flag-975e9974896b7ae5bb867e7f301e97c800808261ac2a53031706b376b8df8a97.jpg">
  <img src="/assets/documentation/WPICTF/flag-975e9974896b7ae5bb867e7f301e97c800808261ac2a53031706b376b8df8a97.jpg" alt="flag" class="zooming" data-rjs="/assets/documentation/WPICTF/flag-975e9974896b7ae5bb867e7f301e97c800808261ac2a53031706b376b8df8a97.jpg" data-zooming-width="256" data-zooming-height="256" />
</a></p>

<p>Thanks to <code class="highlighter-rouge">Jutin</code> the creator of this challenge.
the flag: <code class="highlighter-rouge">WPI{M00N_mOOn}</code></p>

<h2 id="crypto">Crypto</h2>
<hr />

<h3 id="1-illuminati-confirmed">1. Illuminati Confirmed</h3>

<blockquote>
  <p>I’ve intercepted multiple copies of an encrypted message from the leader of the Worcester chapter of the Illuminati. I think it contains the time of their next meeting. Can you help me decrypt them?</p>
</blockquote>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">c1</span><span class="o">=</span><span class="mi">515274042976912179894435774656907420040599503456517078488056218986662017260212389975972477279505310799399071383390618892499008790928347543017765027618590150794317674792875250152206518326158674718404382617692169589911938548819188733852354294583496715425255584973283840789780326402769751705164900106921523637157271605500111846563844641773661723255718653040958019618435501230171699432186518803652675691180548548982155426472648502704469425298466513665043628724497448475714424482446137414939511691724839553567514050622159418495196773388690852258256550787962177196383253952227153557220272199293397879908308572668952866439</span>

<span class="n">c2</span><span class="o">=</span><span class="mi">10512934566887371506285681495672139256544177416158977932082410009242386741198073874632763611137937701329570263046854521709347241390006612379393018933295475369159148328248445221357906382527678877429535168220389698475391828837227453358681276167720605617228338487308750653165147019400915842904872988789759529121710032871148507314874152494680057046977274373381326003405301191489108322498519602528688873942243307708631394538177629868515911161222795303220989599519719169300455717641863368473309673489958952173445661451265442004625237606054046962062434813126456494957846077185121041599277143211160596207640833275850170891378</span>

<span class="n">c3</span><span class="o">=</span><span class="mi">4122591425712279559823043898131225014447235394996958162806737555257607173149332839353292933732548212376056402900761362427837044396517072345683265668973735260384169928448531246071624967168190024583028639591981238222340513125989229227761894026521238496145716707176637113415430809586007230597253976748507442809040629281971868442704017013258355403718545489677897799000961350863824810217217745918503635905775610161826572608564207497464646323778407843991683950506484189720225535503643332574132841288909783555334280205740975729691459011043954137669831817945210956835398278009161994675851980163314376477384045294293755909874</span>

<span class="n">n1</span><span class="o">=</span><span class="mi">21939147590581954242131893557689750173730181114330873782062274456630281986233643990882568426690149971468987847436717513764939861105600249325682418749886588739440853385485272501856860578476795830603738468829294920737586209822299603185425324611481798231193950636987017718955070420091525231666894903436050998112803225822333684113551754209802262129292376015861410644289380376439390552627189657966103965089679163295591136464541998227543058082734503570960156783196006833967361311083486266118899788620317372054292861892020849652213277431575285275801196626852675579752895079650118836892859390462805733596279690076656763624249</span>

<span class="n">n2</span><span class="o">=</span><span class="mi">26325215018784165663958487526715385161171636566916698114816183716597566424675870012796860473421390775180027083457908584461525282815469520282303059318923930531826588673345113634118988713179894971211405380241575065877886390347877768297280022387015195069836149198306647472534681286406136303674462323742151285361538383784282113898065157278366533587767199303585208673225974716800760227497569577072903884939422787710986913747191378087554442395968729847569180921093186599977266346501947184849099856506537976370069200813758143237937721729073822639191799709052936074831322440705620902220824412476988222346922869104007199777561</span>

<span class="n">n3</span><span class="o">=</span><span class="mi">23013589835547680503802140462487647716102548445081685245087901486321520435018899614072711065158868927754813316329675676910885474767916372370942795565358071859270832973837949423193707764788999822539648518439967218163608118921979697363190728350735745938069012584523314223346479156208977445194408267152808800890485882602068876756801123087623323707553203656108124651989136578687688847505350883163751096338640206246619001851586459510648241545637475283654557530338836698680934504086346810521919864048046078444168117563048636886066060497385368685340990757248020960409380316695810483273153565980791846594355984630591111120973</span>

<span class="n">e</span><span class="o">=</span><span class="mi">3</span></code></pre></figure>

<p>The challenge very obvious it gives us some <code class="highlighter-rouge">c1 c2 c3</code> and <code class="highlighter-rouge">n1 n2 n3</code> with <code class="highlighter-rouge">e=3</code> I know it’s a <code class="highlighter-rouge">RSA</code> challenge with very famouse <a href="https://en.wikipedia.org/wiki/Chinese_remainder_theorem">Chinese Remainder Theorem</a> and <a href="https://en.wikipedia.org/wiki/Coppersmith%27s_attack#H%C3%A5stad%27s_broadcast_attack">Coppermith Attack</a>.</p>

<p>Now, the goal is to find <code class="highlighter-rouge">M</code> such that <code class="highlighter-rouge">C = M^3 mod(n1*n2*n3)</code> and we know that <code class="highlighter-rouge">M &lt; Ni</code> so <code class="highlighter-rouge">C = M^3</code> and <code class="highlighter-rouge">M</code> is our message (flag).</p>

<p>Hopefully, there is a method in <code class="highlighter-rouge">sympy</code> library to compute <code class="highlighter-rouge">C</code> and get the flag.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sympy.ntheory.modular</span> <span class="kn">import</span> <span class="n">crt</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">root</span>

<span class="n">c1</span><span class="o">=</span><span class="mi">515274042976912179894435774656907420040599503456517078488056218986662017260212389975972477279505310799399071383390618892499008790928347543017765027618590150794317674792875250152206518326158674718404382617692169589911938548819188733852354294583496715425255584973283840789780326402769751705164900106921523637157271605500111846563844641773661723255718653040958019618435501230171699432186518803652675691180548548982155426472648502704469425298466513665043628724497448475714424482446137414939511691724839553567514050622159418495196773388690852258256550787962177196383253952227153557220272199293397879908308572668952866439</span>

<span class="n">c2</span><span class="o">=</span><span class="mi">10512934566887371506285681495672139256544177416158977932082410009242386741198073874632763611137937701329570263046854521709347241390006612379393018933295475369159148328248445221357906382527678877429535168220389698475391828837227453358681276167720605617228338487308750653165147019400915842904872988789759529121710032871148507314874152494680057046977274373381326003405301191489108322498519602528688873942243307708631394538177629868515911161222795303220989599519719169300455717641863368473309673489958952173445661451265442004625237606054046962062434813126456494957846077185121041599277143211160596207640833275850170891378</span>

<span class="n">c3</span><span class="o">=</span><span class="mi">4122591425712279559823043898131225014447235394996958162806737555257607173149332839353292933732548212376056402900761362427837044396517072345683265668973735260384169928448531246071624967168190024583028639591981238222340513125989229227761894026521238496145716707176637113415430809586007230597253976748507442809040629281971868442704017013258355403718545489677897799000961350863824810217217745918503635905775610161826572608564207497464646323778407843991683950506484189720225535503643332574132841288909783555334280205740975729691459011043954137669831817945210956835398278009161994675851980163314376477384045294293755909874</span>

<span class="n">n1</span><span class="o">=</span><span class="mi">21939147590581954242131893557689750173730181114330873782062274456630281986233643990882568426690149971468987847436717513764939861105600249325682418749886588739440853385485272501856860578476795830603738468829294920737586209822299603185425324611481798231193950636987017718955070420091525231666894903436050998112803225822333684113551754209802262129292376015861410644289380376439390552627189657966103965089679163295591136464541998227543058082734503570960156783196006833967361311083486266118899788620317372054292861892020849652213277431575285275801196626852675579752895079650118836892859390462805733596279690076656763624249</span>

<span class="n">n2</span><span class="o">=</span><span class="mi">26325215018784165663958487526715385161171636566916698114816183716597566424675870012796860473421390775180027083457908584461525282815469520282303059318923930531826588673345113634118988713179894971211405380241575065877886390347877768297280022387015195069836149198306647472534681286406136303674462323742151285361538383784282113898065157278366533587767199303585208673225974716800760227497569577072903884939422787710986913747191378087554442395968729847569180921093186599977266346501947184849099856506537976370069200813758143237937721729073822639191799709052936074831322440705620902220824412476988222346922869104007199777561</span>

<span class="n">n3</span><span class="o">=</span><span class="mi">23013589835547680503802140462487647716102548445081685245087901486321520435018899614072711065158868927754813316329675676910885474767916372370942795565358071859270832973837949423193707764788999822539648518439967218163608118921979697363190728350735745938069012584523314223346479156208977445194408267152808800890485882602068876756801123087623323707553203656108124651989136578687688847505350883163751096338640206246619001851586459510648241545637475283654557530338836698680934504086346810521919864048046078444168117563048636886066060497385368685340990757248020960409380316695810483273153565980791846594355984630591111120973</span>

<span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n3</span><span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">]</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">crt</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">C</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="k">print</span> <span class="n">m</span></code></pre></figure>

<p>And I got ascii integer values for the flag: <code class="highlighter-rouge">WPI{Ch1n3s3_R3M@ind3R_Th30r3m_!_}</code>.</p>

<h2 id="reverse">Reverse</h2>
<hr />

<h3 id="1-notwannasigh">1. NotWannasigh</h3>

<blockquote>
  <p>Please help! An evil script-kiddie (seriously, this is some bad code) was able to get this ransomware “NotWannasigh” onto one of our computers. The program ran and encrypted our file “flag.gif”.
These are the resources we were able to gather for you:</p>
  <ul>
    <li>the malicious ransomware executable
<a href="https://gofile.io/?c=59GptB"><code class="highlighter-rouge">NotWannasigh.zip</code></a></li>
    <li>our poor encrypted file that we need you to recover
<a href="https://gofile.io/?c=ELn6Wi"><code class="highlighter-rouge">flag-gif.EnCiPhErEd</code></a></li>
    <li>the note left behind by the ransomware. I’m not sure you’ll find anything usefull here
ransomNote.txt</li>
    <li>a packet capture that our IDS isolated, it seems that the program has some weird form of data exfiltration
<a href="https://gofile.io/?c=EhS33Y"><code class="highlighter-rouge">192-168-1-11_potential-malware.pcap</code></a></li>
    <li>We need you to reverse the malware and recover our flag.gif file. Good luck!
A note from the creator: Shoutout to Demonslay335 for challenge inspiration - he’s done some awesome work in fighting ransomware. Also, the ransomware in this challenge is programmed to only target files named “flag.gif” so you shouldn’t need to worry about the accidental execution, I just zipped it out of habit/good practice. Have fun and happy hacking!</li>
  </ul>
</blockquote>

<p>The challenge was a little bit easy for me it gives us some network traffic <code class="highlighter-rouge">pcap</code> file, a binary, a text note, and the encrypted flag file. The goal here is to debug the binary and see what it does and reverse the process of encryption. Let’s open the binary in <code class="highlighter-rouge">IDA</code> and see what it looks like.</p>

<p>I noticed there is a main function with some heavy code, so let’s analyze it. From line <code class="highlighter-rouge">26</code> to <code class="highlighter-rouge">52</code> it’s just seeds the <code class="highlighter-rouge">srand</code> with the current time, trying to connect to the socket with address <code class="highlighter-rouge">108.61.127.136</code>, send the seed value and thats so interesting because the same seed produce the same random values.</p>

<p><a href="/assets/documentation/WPICTF/first-d29ecd610ec5095d86a918e2dbcacda236562e6c75067887a830b8f3c1a27107.png">
  <img src="/assets/documentation/WPICTF/first-d29ecd610ec5095d86a918e2dbcacda236562e6c75067887a830b8f3c1a27107.png" alt="flag" class="zooming" data-rjs="/assets/documentation/WPICTF/first-d29ecd610ec5095d86a918e2dbcacda236562e6c75067887a830b8f3c1a27107.png" data-zooming-width="451" data-zooming-height="410" />
</a></p>

<p>From line <code class="highlighter-rouge">54</code> to <code class="highlighter-rouge">58</code> it opens the <code class="highlighter-rouge">flag.gif</code> file in the read mode, save the file size at <code class="highlighter-rouge">v19</code> and print it.</p>

<p><a href="/assets/documentation/WPICTF/second-645a144a915bfbea67c514ce1c5cbcd2d1e68dfeaa905aa6be42b6efb0c79f5d.png">
  <img src="/assets/documentation/WPICTF/second-645a144a915bfbea67c514ce1c5cbcd2d1e68dfeaa905aa6be42b6efb0c79f5d.png" alt="flag" class="zooming" data-rjs="/assets/documentation/WPICTF/second-645a144a915bfbea67c514ce1c5cbcd2d1e68dfeaa905aa6be42b6efb0c79f5d.png" data-zooming-width="347" data-zooming-height="93" />
</a></p>

<p>From <code class="highlighter-rouge">63</code> to <code class="highlighter-rouge">66</code> it produces the random values and put them into an integer array <code class="highlighter-rouge">v17</code> of the same size of the <code class="highlighter-rouge">flag.gif</code>.</p>

<p><a href="/assets/documentation/WPICTF/third-1d4ab4abf2ce727ac236da8cd10a587cce2fb621924e4601601e32b5efab86de.png">
  <img src="/assets/documentation/WPICTF/third-1d4ab4abf2ce727ac236da8cd10a587cce2fb621924e4601601e32b5efab86de.png" alt="flag" class="zooming" data-rjs="/assets/documentation/WPICTF/third-1d4ab4abf2ce727ac236da8cd10a587cce2fb621924e4601601e32b5efab86de.png" data-zooming-width="359" data-zooming-height="63" />
</a></p>

<p>At lines <code class="highlighter-rouge">72</code> to <code class="highlighter-rouge">80</code> it gets the current value from the file, do bitwise <code class="highlighter-rouge">xor</code> with the current random value of array <code class="highlighter-rouge">v17</code>, append the result into an array <code class="highlighter-rouge">v15</code>, close the file, and remove it.</p>

<p><a href="/assets/documentation/WPICTF/forth-444be541964991a17327cfb909511c2d269b9f469e8ff8d3ae9a585b2fb2c45f.png">
  <img src="/assets/documentation/WPICTF/forth-444be541964991a17327cfb909511c2d269b9f469e8ff8d3ae9a585b2fb2c45f.png" alt="flag" class="zooming" data-rjs="/assets/documentation/WPICTF/forth-444be541964991a17327cfb909511c2d269b9f469e8ff8d3ae9a585b2fb2c45f.png" data-zooming-width="347" data-zooming-height="137" />
</a></p>

<p>The last lines <code class="highlighter-rouge">81</code> to <code class="highlighter-rouge">92</code> it opens a new file <code class="highlighter-rouge">flag-gif.EnCiPhErEd</code> in the write mode, put each value of the aray <code class="highlighter-rouge">v15</code> into the file, close the file, open another file to write the text note.</p>

<p><a href="/assets/documentation/WPICTF/fifth-5c74a981b5c6e1e9b50b19ff0ac894eef1436c7f70b73de586f5e8ec20cda246.png">
  <img src="/assets/documentation/WPICTF/fifth-5c74a981b5c6e1e9b50b19ff0ac894eef1436c7f70b73de586f5e8ec20cda246.png" alt="flag" class="zooming" data-rjs="/assets/documentation/WPICTF/fifth-5c74a981b5c6e1e9b50b19ff0ac894eef1436c7f70b73de586f5e8ec20cda246.png" data-zooming-width="535" data-zooming-height="199" />
</a></p>

<p>Now, let’s see the seed value in the pcap file.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>strings 192-168-1-11_potential-malware.pcap 
<span class="go">&lt;n!@
4n"@
</span><span class="gp">&gt;</span>n#@
<span class="go">1585599106
</span><span class="gp">4n$</span>@
<span class="go">d|l=
HHTTP/1.1 400 Bad Request
Server: nginx/1.16.1
Date: Mon, 30 Mar 2020 20:14:58 GMT
Content-Type: text/html
Content-Length: 157
Connection: close
</span><span class="gp">&lt;html&gt;</span><span class="w">
</span><span class="gp">&lt;head&gt;</span>&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;
<span class="gp">&lt;body&gt;</span><span class="w">
</span><span class="gp">&lt;center&gt;</span>&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;
<span class="gp">&lt;hr&gt;</span>&lt;center&gt;nginx/1.16.1&lt;/center&gt;
<span class="gp">&lt;/body&gt;</span><span class="w">
</span><span class="gp">&lt;/html&gt;</span><span class="w">
</span><span class="gp">root@kali:~#</span><span class="w"> </span><span class="nb">date</span> <span class="nt">-d</span> @1585599106
<span class="go">Mon 30 Mar 2020 10:11:46 PM EET</span></code></pre></figure>

<p>I assumed the seed value is <code class="highlighter-rouge">1585599106</code> and I checked with <code class="highlighter-rouge">date</code> it tells me the acual time when the program ran.</p>

<p>After that I have the seed and the encrypted flag file, so let’s wrote some code the reverse the process and get the <code class="highlighter-rouge">file.gif</code>.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include&lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="n">SEED</span> <span class="o">=</span> <span class="mi">1585599106</span><span class="p">,</span> <span class="n">SIZE</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">srand</span><span class="p">(</span><span class="n">SEED</span><span class="p">);</span>

  <span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"flag-gif.EnCiPhErEd"</span><span class="p">,</span><span class="s">"r+"</span><span class="p">);</span>
  <span class="n">fseek</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">SIZE</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
  <span class="n">fseek</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="kt">int</span> <span class="o">*</span><span class="n">keys</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span> <span class="n">calloc</span><span class="p">(</span><span class="n">SIZE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">dec_bts</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">calloc</span><span class="p">(</span><span class="n">SIZE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>

  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>

  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">enc</span> <span class="o">=</span> <span class="n">fgetc</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
    <span class="n">dec_bts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">enc</span> <span class="o">^</span> <span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>

  <span class="kt">FILE</span> <span class="o">*</span><span class="n">flag</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">"flag.gif"</span><span class="p">,</span><span class="s">"w+"</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SIZE</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>  <span class="n">fputc</span><span class="p">(</span><span class="n">dec_bts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">flag</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p><a href="/assets/documentation/WPICTF/flag-897bdbd1632cdc92c6bfc1b8d7afdbbca574a3d4248c52e066c93bfc9e57593a.gif">
  <img src="/assets/documentation/WPICTF/flag-897bdbd1632cdc92c6bfc1b8d7afdbbca574a3d4248c52e066c93bfc9e57593a.gif" alt="flag" class="zooming" data-rjs="/assets/documentation/WPICTF/flag-897bdbd1632cdc92c6bfc1b8d7afdbbca574a3d4248c52e066c93bfc9e57593a.gif" data-zooming-width="220" data-zooming-height="124" />
</a></p>

<p>And the flag: <code class="highlighter-rouge">WPI{It_always_feels_a_little_weird_writing_malware}</code></p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=WPICTF+2020%20-%20https://y4mm1.github.io/posts/wpictf-2020" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://y4mm1.github.io/posts/wpictf-2020" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://my-blog-0vgcdsd8x2.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
    <p style="text-align: center">
      This is my little tech blog, feel free to ask me any question &#169;
      <a href="/about" title="About me">Ahmed Sayed</a>
    </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-157807027-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-157807027-1');
  </script>


<script type="text/javascript" src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js"></script>


  <script type="text/javascript" src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


</body>
</html>
