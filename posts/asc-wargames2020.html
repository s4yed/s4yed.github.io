<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Ahmed | ASC - Wargames 2020 Filtration Phase</title>
    <meta
      name="description"
      content="This is my writeup and walkthrough for the Challenge2 crypto from the competition"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:title" content="ASC - Wargames 2020 Filtration Phase" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://s4yed.github.io/posts/asc-wargames2020"
    />
    <meta
      property="og:description"
      content="This is my writeup and walkthrough for the Challenge2 crypto from the competition"
    />
    <meta property="og:site_name" content="Ahmed" />

    <meta name="twitter:card" content="summary" />
    <meta
      name="twitter:url"
      content="https://s4yed.github.io/posts/asc-wargames2020"
    />
    <meta name="twitter:title" content="ASC - Wargames 2020 Filtration Phase" />
    <meta
      name="twitter:description"
      content="This is my writeup and walkthrough for the Challenge2 crypto from the competition"
    />

    <meta
      property="og:image"
      content="https://s4yed.github.io/assets/documentation/ASCWargames/2020/banner-5e7c94ec26d0e81bcdc1f800b2e3d2828de0a113dd6906080f50a2c540a6e8bd.png"
    />
    <meta
      name="twitter:image"
      content="https://s4yed.github.io/assets/documentation/ASCWargames/2020/banner-5e7c94ec26d0e81bcdc1f800b2e3d2828de0a113dd6906080f50a2c540a6e8bd.png"
    />

    <link
      href="https://s4yed.github.io/feed.xml"
      type="application/rss+xml"
      rel="alternate"
      title="Ahmed Last 10 blog posts"
    />

    <link
      rel="icon"
      type="image/x-icon"
      href="/assets/favicon-color-0e896bd8673d9f83cea8d7b0a12fcc894681d58fc475ad499adfed94067b1e1f.png"
    />
    <link
      rel="apple-touch-icon"
      href="/assets/apple-touch-icon-dark-d161409442b7e523089f24d08d0a55951549ece7504207c376d53b020713494d.png"
    />
    <link
    rel="stylesheet"
    type="text/css"
    title="light"
    id="light"
    href="/assets/light-b844ce2b2c3063f66fe208d0ea1d8acb9fd6089d25f05cd0c45c3f9d10e0e574.css"
  />
  <link
    rel="stylesheet"
    type="text/css"
    title="dark"
    id="dark"
    href="/assets/dark-c6918cbe82fc04b68125b494e6c23ce9c7935d17fe74045d6b9021f137109a04.css"
    disabled="false"
  />

    <!-- Load KaTeX -->
    <link
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.1.1/katex.min.css"
    />
    <script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.1.1/katex.min.js"></script>
  </head>

  <body>
    <main>
      <div class="grid grid-centered">
        <div class="grid-cell">
          <nav class="header-nav scrollappear">
            <a href="/" class="header-logo" title="Ahmed">Ahmed</a>
            <ul class="header-links">
              <li>
                <a href="/about" title="About me">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
                    <use
                      href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about"
                      xlink:href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about"
                    ></use>
                  </svg>
                </a>
              </li>

              <li>
                <a
                  href="https://github.com/s4yed"
                  rel="noreferrer noopener"
                  target="_blank"
                  title="GitHub"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
                    <use
                      href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github"
                      xlink:href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github"
                    ></use>
                  </svg>
                </a>
              </li>

              <li>
                <a
                  href="https://www.linkedin.com/in/s4yed"
                  rel="noreferrer noopener"
                  target="_blank"
                  title="LinkedIn"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
                    <use
                      href="/assets/linkedin-3bd8eb5ea036958dc7b3ee3de6612dbfa9e0744f369f20f7895d6a2782bbaf43.svg#icon-linkedin"
                      xlink:href="/assets/linkedin-3bd8eb5ea036958dc7b3ee3de6612dbfa9e0744f369f20f7895d6a2782bbaf43.svg#icon-linkedin"
                    ></use>
                  </svg>
                </a>
              </li>

              <li>
                <a
                  href="https://discord.gg/Y4mm1#7774"
                  rel="noreferrer noopener"
                  target="_blank"
                  title="Discord Server"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon-discord">
                    <use
                      href="/assets/discord-31958f8a24fd49834876e398b1793cd068c7d12a1db745c6da2ecc8b1f7576f5.svg#icon-discord"
                      xlink:href="/assets/discord-31958f8a24fd49834876e398b1793cd068c7d12a1db745c6da2ecc8b1f7576f5.svg#icon-discord"
                    ></use>
                  </svg>
                </a>
              </li>

              <li>
                <a
                  href="/feed.xml"
                  rel="noreferrer noopener"
                  target="_blank"
                  title="RSS"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
                    <use
                      href="/assets/rss-cdc7a721b47671668abb0ba57f9f8db8022096e0051ff51b9e08e6cc049453a4.svg#icon-rss"
                      xlink:href="/assets/rss-cdc7a721b47671668abb0ba57f9f8db8022096e0051ff51b9e08e6cc049453a4.svg#icon-rss"
                    ></use>
                  </svg>
                </a>
              </li>

              <li>
                <a onclick="toggle()" title="Toggle Theme">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
                    <use
                      href="/assets/theme-610197c56844c5ba34608b2018c4cc3b79f8833e2efc7a99bcb5589f1d3cfd7b.svg#icon-theme"
                      xlink:href="/assets/theme-610197c56844c5ba34608b2018c4cc3b79f8833e2efc7a99bcb5589f1d3cfd7b.svg#icon-theme"
                    ></use>
                  </svg>
                </a>
              </li>
            </ul>
          </nav>

          <ul class="header-tags scrollappear">
            <li><a href="/tag/AES">Aes</a></li>

            <li><a href="/tag/ASC-Wargames">Asc-wargames</a></li>

            <li><a href="/tag/AUCTF">Auctf</a></li>

            <li><a href="/tag/AnDetect">Andetect</a></li>

            <li><a href="/tag/CTF">Ctf</a></li>

            <li><a href="/tag/ECC">Ecc</a></li>

            <li><a href="/tag/RSA">Rsa</a></li>

            <li><a href="/tag/WPICTF">Wpictf</a></li>

            <li><a href="/tag/algorithms">Algorithms</a></li>

            <li><a href="/tag/analysis">Analysis</a></li>

            <li>...</li>
            <li><a href="/tags">Show all</a></li>
          </ul>

          <article class="article scrollappear">
            <header class="article-header">
              <h1>ASC - Wargames 2020 Filtration Phase</h1>
              <p>
                This is my writeup and walkthrough for the Challenge2 crypto
                from the competition
              </p>
              <div class="article-list-footer">
                <span class="article-list-date"> August 15, 2020 </span>
                <span class="article-list-divider">-</span>
                <span class="article-list-minutes"> 7 minute read </span>
                <span class="article-list-divider">-</span>
                <div class="article-list-tags">
                  <a
                    href="/tag/security"
                    title="See all posts with tag 'Security'"
                    >Security</a
                  >

                  <a
                    href="/tag/ASC-Wargames"
                    title="See all posts with tag 'ASC-Wargames'"
                    >ASC-Wargames</a
                  >

                  <a href="/tag/CTF" title="See all posts with tag 'CTF'"
                    >CTF</a
                  >

                  <a
                    href="/tag/infosec"
                    title="See all posts with tag 'Infosec'"
                    >Infosec</a
                  >

                  <a href="/tag/python" title="See all posts with tag 'Python'"
                    >Python</a
                  >

                  <a
                    href="/tag/hacking"
                    title="See all posts with tag 'Hacking'"
                    >Hacking</a
                  >

                  <a
                    href="/tag/cryptography"
                    title="See all posts with tag 'Cryptography'"
                    >Cryptography</a
                  >

                  <a
                    href="/tag/cracking"
                    title="See all posts with tag 'cracking'"
                    >cracking</a
                  >
                </div>
              </div>
            </header>

            <div class="article-content">
              <p>
                This is the Qualification phase for ASC War Games at Egypt.
                There was 5 crypto challenges in the competition and I’ll go
                through the Challenge2, the most interesting one for me.
              </p>

              <p>
                <a
                  href="/assets/documentation/ASCWargames/2020/banner-5e7c94ec26d0e81bcdc1f800b2e3d2828de0a113dd6906080f50a2c540a6e8bd.png"
                >
                  <img
                    src="/assets/documentation/ASCWargames/2020/banner-5e7c94ec26d0e81bcdc1f800b2e3d2828de0a113dd6906080f50a2c540a6e8bd.png"
                    alt="ASC"
                    class="zooming"
                    data-rjs="/assets/documentation/ASCWargames/2020/banner-5e7c94ec26d0e81bcdc1f800b2e3d2828de0a113dd6906080f50a2c540a6e8bd.png"
                    data-zooming-width="1239"
                    data-zooming-height="605"
                  />
                </a>
              </p>

              <h3 id="analyzing-the-challenge">Analyzing the challenge</h3>

              <p>
                The challenge give us 2 files
                <code class="language-plaintext highlighter-rouge"
                  >challenge.py</code
                >
                script contains the encryption algorithm and
                <code class="language-plaintext highlighter-rouge"
                  >output.txt</code
                >. the
                <code class="language-plaintext highlighter-rouge"
                  >output.txt</code
                >
                file contains
                <code class="language-plaintext highlighter-rouge">temp</code>
                and
                <code class="language-plaintext highlighter-rouge">cipher</code>
                variables.
              </p>

              <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="go">temp = 37575548727135643944546138552f432b4748447a6d465a3954304c642b6d71455968774b4649674950704868714552547767682b503036776b4d6e475a615036494539503166796470536744312f53477978625030667a553373306874313478306e49324c7453375851424a5162646b33544e4f776c6737704148664e7a4b7a6859797550436b70634f7566554b485976787667386b506f526374457747493556786d624c43753631525072326a456f613054346c4c494661614b4252663773454a6674546f37496...
cipher = 37642f4574474258656752564f3437555667442b6d71684d2b5a3052756147734b5674526264567a727466434f676a74794767556e765a6f6e756b4652484535</span></code></pre>
              </figure>

              <p>So, let’s look at the script file that was given.</p>

              <figure class="highlight">
                <pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">printable</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">pad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">*</span> <span class="nb">chr</span><span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span>
<span class="n">unpad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:])]</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">plain</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">plain</span><span class="p">)</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="p">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">cipher</span><span class="p">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">plain</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">generate_random</span><span class="p">():</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="n">printable</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">temp</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">return</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">choose_random</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">letters</span> <span class="o">=</span> <span class="n">printable</span>
    <span class="n">a</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
    <span class="k">return</span> <span class="n">b</span>

<span class="n">all_keys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">all_keys</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">choose_random</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">plain</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">"temp.txt"</span><span class="p">).</span><span class="n">read</span><span class="p">()).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">c3</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">c4</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">c5</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">c4</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">c6</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">c5</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">c7</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">c6</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="n">c8</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">c7</span><span class="p">,</span> <span class="n">all_keys</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>

<span class="n">random</span> <span class="o">=</span> <span class="n">generate_random</span><span class="p">()</span>
<span class="n">c9</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">c8</span><span class="p">,</span><span class="n">random</span><span class="o">*</span><span class="mi">4</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"temp = "</span><span class="p">,</span> <span class="n">c9</span>

<span class="n">key</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_keys</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="n">i</span>

<span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

<span class="n">cipher</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">key</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">"hex"</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"cipher = "</span><span class="p">,</span><span class="n">cipher</span></code></pre>
              </figure>

              <p>After looking at the script, It has 3 functions :</p>
              <ul>
                <li>
                  <code class="language-plaintext highlighter-rouge"
                    >encrypt(plain, key)</code
                  >: It’s just create
                  <code class="language-plaintext highlighter-rouge">AES</code>
                  instanse and return
                  <code class="language-plaintext highlighter-rouge"
                    >base64</code
                  >
                  of the encrypted text with a given key.
                </li>
                <li>
                  <code class="language-plaintext highlighter-rouge"
                    >choose_random(length=1)</code
                  >: This function return 2 bytes random string given a
                  specified length or 1 random byte as a default value.
                </li>
                <li>
                  <code class="language-plaintext highlighter-rouge"
                    >generate_random()</code
                  >: Same as the above but it just returns 4 bytes random
                  string.
                </li>
              </ul>

              <p>
                Then, the script generates 2 bytes keys, repeat that 8 times,
                and put them into a list of
                <code class="language-plaintext highlighter-rouge"
                  >all_keys</code
                >. After that, it performs 9 encryption operations on some data
                in
                <code class="language-plaintext highlighter-rouge"
                  >temp.txt</code
                >
                file.
              </p>

              <p>
                So, the vulnerability here is it encrypts the hex value of the
                data not on the raw bytes itself and we can take advantage of
                that by checking the decryption upon every possible subkey of
                length 2 is hex values if so, then we got the correct subkey.
              </p>

              <h4 id="note-that">Note that:</h4>

              <ol>
                <li>
                  The last operation 9 it performs the same process but on the
                  key of length 4, so let’s first get the 4 bytes key.
                </li>
                <li>
                  All the keys that is being used are repeated to be 16 bytes
                  long.
                </li>
              </ol>

              <p>
                After analyzing the bruteforce search space we got
                <code class="language-plaintext highlighter-rouge"
                  >len(printable) = 100</code
                >, therefore 4 bytes string has
                <code class="language-plaintext highlighter-rouge"
                  >100*100*100*100 = 10^8</code
                >
                possible key values and 2 bytes string has
                <code class="language-plaintext highlighter-rouge"
                  >100*100 = 10000</code
                >
                possible values. So, it’s feasible to bruteforce the keys with
                the
                <code class="language-plaintext highlighter-rouge"
                  >itertools</code
                >
                library in python.
              </p>

              <h3 id="cracking-the-4-bytes-key">Cracking the 4 bytes key</h3>

              <p>
                I wrote some python script to get all the possible combination
                of the 4 bytes key and try them.
              </p>

              <figure class="highlight">
                <pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python3
</span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">printable</span>
<span class="kn">from</span> <span class="nn">output</span> <span class="kn">import</span> <span class="n">temp</span><span class="p">,</span> <span class="n">flag_enc</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>

<span class="n">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">pad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">*</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span>
<span class="n">unpad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:])]</span>

<span class="k">def</span> <span class="nf">is_hex</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="p">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unpad</span><span class="p">(</span><span class="n">cipher</span><span class="p">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">rep</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">printable</span><span class="p">,</span><span class="n">repeat</span><span class="o">=</span><span class="n">rep</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">BLOCK_SIZE</span><span class="o">//</span><span class="n">rep</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">key</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">is_hex</span><span class="p">(</span><span class="n">dec</span><span class="p">):</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">dec</span><span class="p">.</span><span class="n">decode</span><span class="p">())</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'[+] Key: </span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="si">:</span><span class="n">rep</span><span class="p">]</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">key</span><span class="p">[:</span><span class="n">rep</span><span class="p">],</span> <span class="n">dec</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<span class="n">key</span><span class="p">,</span> <span class="n">C8</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span></code></pre>
              </figure>

              <p>
                I got the first big key
                <code class="language-plaintext highlighter-rouge"
                  >099!099!099!099!</code
                >
                and now the value
                <code class="language-plaintext highlighter-rouge">C8</code> can
                be used to get
                <code class="language-plaintext highlighter-rouge">Ci</code>
                where
                <code class="language-plaintext highlighter-rouge"
                  >0 &lt;= i &lt;= 7</code
                >
                and
                <code class="language-plaintext highlighter-rouge">C0</code> is
                the original
                <code class="language-plaintext highlighter-rouge">temp</code>
                plain text.
              </p>

              <h3 id="cracking-all-the-2-bytes-keys">
                Cracking all the 2 bytes keys
              </h3>

              <p>
                Before running the following script I got a one byte value
                problem from the
                <code class="language-plaintext highlighter-rouge">dec</code>
                variable while decrypting the
                <code class="language-plaintext highlighter-rouge">Ci</code>. So
                let’s check if the decryption string is greater than 1 by
                editing the
                <code class="language-plaintext highlighter-rouge">run</code>
                function and put
                <code class="language-plaintext highlighter-rouge"
                  >if is_hex(dec) and len(dec) &gt; 1:</code
                >
              </p>

              <figure class="highlight">
                <pre><code class="language-python" data-lang="python"><span class="n">Ci</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">C8</span><span class="p">)</span>
<span class="n">all_keys</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">subkey</span><span class="p">,</span> <span class="n">C7</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">all_keys</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">subkey</span><span class="p">)</span>
    <span class="n">Ci</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">C7</span><span class="p">)</span></code></pre>
              </figure>

              <p>And now we got all the keys.</p>

              <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="go">[+] Key: 7!
[+] Key: 33
[+] Key: _1
[+] Key: 1s
[+] Key: y_
[+] Key: ke
[+] Key: e_
[+] Key: th</span></code></pre>
              </figure>

              <h3 id="the-flag">The flag</h3>

              <p>
                Because we’ve been decrypting from
                <code class="language-plaintext highlighter-rouge">C9</code>,
                let’s reverse them and put them together as the final key to get
                the flag.
              </p>

              <figure class="highlight">
                <pre><code class="language-python" data-lang="python"><span class="n">flag_key</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">all_keys</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'[+] Final Key: </span><span class="si">{</span><span class="n">flag_key</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="n">flag_enc</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">flag_enc</span><span class="p">))</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">flag_enc</span><span class="p">,</span> <span class="n">flag_key</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">decode</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'[+] Flag: </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="s">'</span><span class="p">)</span></code></pre>
              </figure>

              <p>Eventually, the flag is here.</p>

              <figure class="highlight">
                <pre><code class="language-console" data-lang="console"><span class="go">[+] Final Key: the_key_1s_1337!
[+] Flag: ASCWG{Th1s_A3S_1s_N0T_S3cure_1337}</span></code></pre>
              </figure>
            </div>
            <div class="article-share">
              <a
                href="https://twitter.com/home?status=ASC+-+Wargames+2020+Filtration+Phase%20-%20https://s4yed.github.io/posts/asc-wargames2020"
                title="Share on Twitter"
                rel="noreferrer noopener"
                target="_blank"
              >
                <svg viewBox="0 0 512 512">
                  <path
                    d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"
                  />
                </svg>
              </a>
              <a
                href="https://www.facebook.com/sharer/sharer.php?u=https://s4yed.github.io/posts/asc-wargames2020"
                title="Share on Facebook"
                rel="noreferrer noopener"
                target="_blank"
              >
                <svg viewBox="0 0 512 512">
                  <path
                    d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"
                  />
                </svg>
              </a>
            </div>

            <div id="disqus_thread" class="article-comments"></div>
            <script
              src="https://my-blog-0vgcdsd8x2.disqus.com/embed.js"
              async
              defer
            ></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          </article>
          <footer class="footer scrollappear">
            <p style="text-align: center">
              My little tech blog &#169; 2024
              <!-- <a href="/about" title="About me">Ahmed Sayed</a> -->
            </p>
          </footer>
        </div>
      </div>
    </main>

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-157807027-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "UA-157807027-1");
    </script>

    <script
      src="/assets/vendor-3ee2c63bbac916f96cd7f90e83ab767f058ead1301444c9966f5156911c8be7f.js"
      type="text/javascript"
    ></script>

    <script
      src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"
      type="text/javascript"
    ></script>

    <script
      src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"
      type="text/javascript"
    ></script>

    <script
      src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"
      type="text/javascript"
    ></script>

    <script
      src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js"
      type="text/javascript"
    ></script>

    <script
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
      type="text/javascript"
    ></script>
  </body>
</html>
